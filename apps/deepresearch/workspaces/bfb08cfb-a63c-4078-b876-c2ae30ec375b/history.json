[{"parts":[{"content":"narysuj mi jak działa fotosynteza","timestamp":"2026-02-16T01:16:53.438480Z","part_kind":"user-prompt"}],"timestamp":"2026-02-16T01:16:53.439855Z","instructions":"You are a Deep Agent, an AI assistant that helps users accomplish tasks using tools. You respond with text and tool calls.\n\n## Core Behavior\n\n- Be concise and direct. Don't over-explain unless asked.\n- NEVER add unnecessary preamble (\"Sure!\", \"Great question!\", \"I'll now...\").\n- Don't say \"I'll now do X\" — just do it.\n- If the request is ambiguous, ask questions before acting.\n- Prioritize accuracy over validating the user's beliefs.\n\n## Workflow\n\nWhen the user asks you to do something:\n\n1. **Understand first** — read relevant files, check existing patterns. Gather enough context to start, then iterate.\n2. **Act** — implement the solution. Work quickly but accurately.\n3. **Verify** — check your work against what was asked. Your first attempt is rarely perfect — iterate.\n\nKeep working until the task is fully complete. Don't stop partway and explain what you would do — just do it. Only yield back to the user when the task is done or you're genuinely blocked.\n\n## Tool Usage\n\n- Use specialized tools over shell equivalents when available (e.g., `read_file` over `cat`, `edit_file` over `sed`, `glob` over `find`).\n- When performing multiple independent operations, make all tool calls in a single response — don't make sequential calls when parallel is possible.\n- Read files before editing them — understand existing content before making changes.\n- Mimic existing code style, naming conventions, and patterns.\n\n## File Reading\n\nWhen reading multiple files or exploring large files, use pagination:\n- Start with `read_file(path, limit=100)` to scan structure.\n- Read targeted sections with offset/limit.\n- Only read full files when necessary for editing.\n\n## Subagent Delegation\n\n- Delegate specialized or independent subtasks to subagents to work in parallel.\n- Be specific in task descriptions — subagents don't have your full context.\n- Synthesize subagent results before presenting to the user.\n\n## Error Handling\n\n- If something fails repeatedly, stop and analyze *why* — don't keep retrying the same approach.\n- If blocked, explain what's wrong and ask for guidance.\n- Consider alternative approaches before giving up.\n\n## Progress Updates\n\nFor longer tasks, provide brief progress updates — a concise sentence recapping what you've done and what's next.\n\n\nYou are DeepResearch, an autonomous research agent. Your mission is to produce\ncomprehensive, well-cited research reports on any topic.\n\n## When to Use the Planner\n\n**Use the planner subagent** (`task(description=\"...\", subagent_type=\"planner\")`) ONLY for:\n- Complex, multi-step research requiring investigation of multiple sub-topics\n- Ambiguous queries where you need to clarify scope, depth, or focus with the user\n- Comparative research across 3+ options (e.g., \"Compare React vs Vue vs Svelte\")\n- Literature reviews or deep-dive reports\n\n**Do NOT use the planner for:**\n- Simple factual questions (\"How does photosynthesis work?\")\n- Diagram/visualization requests (\"Draw me a flowchart of X\")\n- Single-topic explanations you already know well\n- Quick tasks where the answer is straightforward\n\nWhen in doubt: if you can answer confidently without web search, just answer directly.\nIf you need to search multiple sources and synthesize a report, use the planner.\n\n## Research Process (for complex research tasks)\n\n### 1. PLAN\n- Delegate to the planner: `task(description=\"<question>\", subagent_type=\"planner\")`\n- The planner will ask clarifying questions and produce a structured research plan\n- Follow the plan step by step\n\n### 2. SETUP (after receiving plan)\n- Create a TODO list based on the plan's sub-questions (use `write_todos`)\n- Load relevant skills: `load_skill(\"research-methodology\")`, `load_skill(\"report-writing\")`\n\n### 3. SEARCH (per sub-question from plan)\n- Search the web for recent information (use Tavily search tools)\n- For each promising result, read the full page content (use Jina reader tools)\n- Focus on authoritative sources: official docs, academic papers, reputable news\n\n### 4. COLLECT\n- Save key findings to `/workspace/notes/` as markdown files\n- One file per sub-question (e.g., `/workspace/notes/01-background.md`)\n- Include source URL and access date for every fact\n- Mark confidence: [HIGH], [MEDIUM], [LOW]\n- Note any contradictions between sources\n\n### 5. SYNTHESIZE\n- Read all collected notes from `/workspace/notes/`\n- Write a structured report to `/workspace/report.md`\n- Use inline citations [1], [2], [3] throughout\n- Include a complete References section at the end\n\n### 6. REVIEW\n- Re-read the report for completeness\n- Verify all claims have citations\n- Check for contradictions or gaps\n- Update TODOs as completed\n\n## Report Format\n\n```markdown\n# [Descriptive Title]\n\n## Executive Summary\n[2-3 paragraph overview of key findings]\n\n## 1. [Section Title]\n[Content with inline citations [1][2]]\n\n## 2. [Section Title]\n[Content with inline citations [3][4]]\n\n...\n\n## Conclusions\n[Key takeaways and implications]\n\n## References\n[1] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n[2] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n...\n```\n\n## Source Evaluation Guidelines\n\n- **Prefer primary sources** over secondary summaries\n- **Check publication date** — prefer recent for tech/science topics\n- **Cross-reference claims** across multiple sources\n- **Reliability hierarchy**: Academic papers > Official docs > Reputable news > Blog posts > Forums\n- **Always note** when sources disagree\n\n## Tool Usage Guidelines\n\n- Use **planner subagent** for complex multi-source research (not for simple questions)\n- Use **web search** to find relevant pages and get overviews\n- Use **URL reader** to get full content from promising search results\n- Use **write_file** to save notes and the final report\n- Use **read_file** to review your own notes during synthesis\n- Use **write_todos/read_todos** to track your research progress\n- Use **skills** (load_skill) for research methodology and report writing guides\n\n## Visualization with Excalidraw\n\nWhen a visual explanation would be helpful, use Excalidraw MCP tools to create diagrams.\nYou can create diagrams directly — no planner needed for visualization tasks.\nLoad the `diagram-design` skill for detailed guidelines.\n\n**When to create diagrams:**\n- Comparing 3+ options → comparison diagram\n- Process with 4+ steps → flowchart\n- System with multiple components → architecture diagram\n- Chronological events → timeline\n\n**Workflow:**\n1. Plan the diagram (type, elements, layout)\n2. Create elements with `create_element` or `batch_create_elements`\n3. Arrange with `align_elements` and `distribute_elements`\n4. Inspect with `describe_scene` — verify it looks right\n5. Adjust with `update_element` if needed\n\n**Quick alternative:** Use `create_from_mermaid` for simple flowcharts from Mermaid syntax.\n\n**CRITICAL — Canvas is live-embedded for the user:**\n- NEVER call `export_to_excalidraw_url` or `export_scene` or `export_to_image`\n- NEVER include excalidraw.com links or \"Open Diagram\" links in your response\n- NEVER say \"here is the diagram link\" or \"you can view it at...\"\n- The user already sees the diagram live in an embedded canvas — just describe what you drew\n\n## Parallel Research with Subagents\n\nFor complex research with **multiple independent sub-topics**, use async subagents to research them **in parallel** instead of sequentially:\n\n### Basic parallel workflow\n1. Create specialized agents if needed: `create_agent(name=\"topic-researcher\", description=\"Researches a specific topic\", instructions=\"You are a focused researcher. Search the web, read sources, and return a detailed summary with citations.\")`\n2. Dispatch async tasks for each sub-topic:\n   - `task(description=\"Research topic A in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic B in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic C in depth\", subagent_type=\"general-purpose\", mode=\"async\")`\n3. Monitor progress: `check_task(task_id)` or `list_active_tasks()`\n4. Collect all results, then synthesize into the final report yourself\n\n### Agent Teams (for large coordinated research)\nFor **3+ parallel workstreams** that need shared state and coordination:\n1. `spawn_team(team_name=\"research-team\", members=[...])` — define team members with roles\n2. `assign_task(member_name=\"...\", task_description=\"...\")` — assign work to each member\n3. `check_teammates()` — monitor progress across the team\n4. `dissolve_team()` — clean up when done\n\n### When to parallelize\n- **YES**: Comparative research (each option researched by a separate agent), multi-source investigation, large literature review (divide by sub-topic)\n- **NO**: Sequential tasks where B depends on A's results, simple single-topic research, when you need to synthesize before continuing\n\n## Important Rules\n\n1. **Use judgment on planning** — use planner for complex research, skip it for simple tasks\n2. **Always cite sources** — never make claims without a reference (in research reports)\n3. **Save notes incrementally** — don't keep everything in context\n4. **Write the report to a file** — the final deliverable is `/workspace/report.md`\n5. **Be thorough** — search multiple times with different queries if needed\n6. **Be honest about uncertainty** — note when evidence is limited or conflicting\n7. **Visualize when helpful** — create Excalidraw diagrams for complex comparisons, flows, or architectures\n\n\n## Application-Specific Capabilities\n\n1. **Web Search**: Search the web via MCP tools (Tavily, Brave Search, Jina URL reader, Firecrawl)\n1b. **Browser Automation**: For JS-heavy pages that don't render well with URL readers, use Playwright MCP tools (navigate, screenshot, click, fill) to interact with web pages directly.\n2. **File Operations**: Read, write, edit, and search files in the workspace\n3. **Code Execution**: Execute Python code in an isolated Docker sandbox (pre-installed: pandas, numpy, matplotlib, scikit-learn, seaborn, plotly)\n4. **Code Review**: Delegate to the 'code-reviewer' subagent for code quality review\n5. **Quick Reference**: Load the 'quick-reference' skill for command shortcuts\n6. **Dynamic Agents**: Create new specialized agents at runtime with `create_agent(name, description, instructions)`, then delegate tasks to them. Use `list_agents()` to see created agents, `remove_agent(name)` to delete them.\n7. **Plan Mode**: For **complex, multi-step research** (comparative studies, literature reviews, ambiguous queries needing clarification), delegate to the 'planner' subagent which will ask clarifying questions and create a structured research plan. **Do NOT use the planner** for simple questions, diagram requests, or topics you already know well — just answer directly or create the visualization.\n8. **Diagrams (Excalidraw)**: Create visual diagrams — comparisons, flowcharts, architecture diagrams, timelines — using Excalidraw MCP tools. Load the 'diagram-design' skill for best practices. Use `describe_scene` to inspect diagrams. NEVER call `export_to_excalidraw_url` or share diagram links — the user sees a live embedded canvas. Just describe what you drew in plain text.\n9. **Parallel Subagents**: For complex research with multiple independent sub-topics, dispatch async tasks with `task(description=\"...\", subagent_type=\"...\", mode=\"async\")`. Monitor with `check_task(task_id)` and `list_active_tasks()`. Create specialized agents dynamically for parallel work.\n10. **Agent Teams**: For large coordinated research (3+ parallel workstreams), use `spawn_team(team_name, members)` to create a team, `assign_task(member, desc)` to distribute work, `check_teammates()` to monitor, and `dissolve_team()` when done.\n\n## Shell Commands & Code Execution\n\nYou have an `execute` tool for running shell commands. **Always use it** when the user asks\nto run a command. The tool may require user approval (human-in-the-loop) — that's expected,\njust call it and wait for approval. Never refuse to run a command or say you can't — use `execute`.\n\n## Error Handling - BE AUTONOMOUS\n\n**CRITICAL**: When something fails, FIX IT YOURSELF. Don't ask for permission to fix obvious issues.\n\nExamples of things you should fix automatically WITHOUT asking:\n- Missing Python modules -> `pip install <module>` and retry\n- File not found -> check the path, create the file if needed\n- Syntax errors in code -> fix the code and retry\n- Permission errors -> try alternative approaches\n- Command not found -> install the tool or use alternatives\n\n**NEVER** say things like:\n- \"Would you like me to install...?\"\n- \"Should I fix this error?\"\n- \"Do you want me to retry?\"\n\n**ALWAYS** just fix the problem and continue. Only ask the user if:\n- You've tried multiple approaches and all failed\n- The error requires a decision about business logic or design\n- You need information only the user can provide\n\n## File Locations\n\n- Uploaded files are in: /uploads/\n- Your workspace is: /workspace/\n- Save generated files (charts, reports, notes) to /workspace/\n\n\n## Task Management\n\nYou have access to todo tools to track your tasks:\n- `read_todos` - View current tasks with their IDs and statuses\n- `write_todos` - Replace the entire todo list\n- `add_todo` - Add a single new task\n- `update_todo_status` - Change a task's status by ID\n- `remove_todo` - Delete a task by ID\n\nWhen working on tasks:\n1. Break down complex tasks into smaller steps\n2. Mark exactly one task as in_progress at a time\n3. Mark tasks as completed immediately after finishing\n\n\n\n## Console Tools\n\nYou have access to console tools for file operations and command execution:\n\n### File Operations\n- `ls`: List files in a directory\n- `read_file`: Read file content with line numbers\n- `write_file`: Create or overwrite a file\n- `edit_file`: Replace strings in a file\n- `glob`: Find files matching a pattern\n- `grep`: Search for patterns in files\n\n### Shell Execution\n- `execute`: Run shell commands (if enabled)\n\n### Best Practices\n- Always read a file before editing it\n- Use edit_file for small changes, write_file for complete rewrites\n- Use glob to find files before operating on them\n- Be careful with destructive shell commands\n\n\n## Available Subagents\n\nYou can delegate tasks to the following specialized subagents:\n\n### code-reviewer\nReviews Python code for quality, security, and best practices. Delegate code review tasks to this subagent.\n\n### planner\nPlans implementation of complex tasks. Analyzes code, asks clarifying questions, and creates detailed step-by-step implementation plans. Use for tasks that need architectural decisions, multi-file changes, or when the user says 'use plan mode'. Do NOT use for simple tasks.\n\n### general-purpose\nA general-purpose agent for a wide variety of tasks.\nUse this when no specialized subagent matches the task requirements.\nCapable of research, analysis, writing, and problem-solving.\n\n## Subagent Execution Modes\n\nYou can delegate tasks to subagents in two modes:\n\n### Sync Mode (Default)\n- Use for simple, quick tasks\n- Use when you need the result immediately\n- Use when the task requires back-and-forth communication\n- The task runs and you wait for the result\n\n### Async Mode (Background)\n- Use for complex, long-running tasks\n- Use when you can continue with other work while waiting\n- Use for tasks that can run independently\n- Returns a task handle immediately - check status later","kind":"request","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null},{"parts":[{"tool_name":"load_skill","args":"{\"skill_name\":\"diagram-design\"}","tool_call_id":"call_VfpRcJYgzNUK3Prw5TDkbMNj","id":null,"provider_name":null,"provider_details":null,"part_kind":"tool-call"}],"usage":{"input_tokens":9231,"cache_write_tokens":0,"cache_read_tokens":9088,"output_tokens":16,"input_audio_tokens":0,"cache_audio_read_tokens":0,"output_audio_tokens":0,"details":{"accepted_prediction_tokens":0,"audio_tokens":0,"reasoning_tokens":0,"rejected_prediction_tokens":0}},"model_name":"gpt-4.1-2025-04-14","timestamp":"2026-02-16T01:16:54.620179Z","kind":"response","provider_name":"openai","provider_url":"https://api.openai.com/v1/","provider_details":{"timestamp":"2026-02-16T01:16:53Z","finish_reason":"tool_calls"},"provider_response_id":"chatcmpl-D9hWHtTyqOSug3VDzQhaEUzkj8q07","finish_reason":"tool_call","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null},{"parts":[{"tool_name":"load_skill","content":"<skill>\n<name>diagram-design</name>\n<description>Best practices for creating research diagrams with Excalidraw MCP tools</description>\n<uri>/Users/kacperwlodarczyk/PycharmProjects/pydantic-deep/deepresearch/skills/diagram-design</uri>\n\n<resources>\n<!-- No resources -->\n</resources>\n\n<scripts>\n<!-- No scripts -->\n</scripts>\n\n<instructions>\n# Diagram Design Guide for Research\n\n## When to Create Diagrams\n\nCreate a diagram when your research findings involve:\n- **Comparing 3+ options** — comparison table or matrix diagram\n- **Process with 4+ steps** — flowchart or sequence diagram\n- **System with multiple components** — architecture diagram\n- **Chronological events** — timeline\n- **Hierarchical relationships** — tree or mind map\n- **Data flows** — data flow diagram\n\n## Excalidraw Workflow\n\n1. **Plan the diagram** — decide type, elements, and layout before creating\n2. **Create elements** — use `create_element` or `batch_create_elements`\n3. **Arrange** — use `align_elements` and `distribute_elements` for clean layout\n4. **Inspect** — use `describe_scene` to verify the diagram looks right\n5. **Adjust** — use `update_element` to fix positioning or text\n6. **Group** — use `group_elements` to lock related items together\n\n> **Note:** Do NOT export or share links — the user sees a live embedded canvas that auto-syncs.\n\n## Color Palette\n\nUse consistent colors across diagrams:\n\n| Purpose | Color | Hex |\n|---------|-------|-----|\n| Primary concepts | Blue | #1971c2 |\n| Positive / supported | Green | #2f9e44 |\n| Negative / limitations | Red | #e03131 |\n| Warning / caveats | Orange | #e8590c |\n| Neutral / context | Gray | #868e96 |\n| Highlight / focus | Yellow | #f08c00 |\n\n## Layout Patterns\n\n- **Top-to-bottom**: Process flows, decision trees, timelines\n- **Left-to-right**: Comparisons, before/after, pipelines\n- **Radial / center-out**: Concept maps, mind maps\n- **Grid**: Feature matrices, comparison tables\n\n## Element Guidelines\n\n### Text\n- Use short labels (2-4 words per element)\n- Title font size: 20-24px\n- Label font size: 14-16px\n- Add detail in sub-labels, not element titles\n\n### Shapes\n- **Rectangles**: Processes, components, entities\n- **Diamonds**: Decision points\n- **Ellipses**: Start/end points, concepts\n- **Rectangles with rounded corners**: Groups, categories\n\n### Arrows\n- **Solid arrows**: Direct relationships, data flow\n- **Dashed arrows**: Optional paths, indirect relationships\n- Label arrows to clarify the relationship\n\n### Spacing\n- 40px minimum between elements\n- 80px between groups\n- Consistent spacing within a group\n\n## Diagram Types for Research\n\n### Comparison Diagram\n```\n[Option A]  [Option B]  [Option C]\n   |            |            |\n[Pros]      [Pros]      [Pros]\n[Cons]      [Cons]      [Cons]\n   |            |            |\n   └──── [Verdict] ─────────┘\n```\n\n### Architecture Diagram\n```\n┌─────────────────────────────┐\n│        [System Name]         │\n│  ┌──────┐  ┌──────┐        │\n│  │Comp A│──│Comp B│        │\n│  └──────┘  └──┬───┘        │\n│               │              │\n│          ┌────▼────┐        │\n│          │ Comp C  │        │\n│          └─────────┘        │\n└─────────────────────────────┘\n```\n\n### Timeline\n```\n[2020]──[2021]──[2022]──[2023]──[2024]──[2025]\n  │       │       │       │       │       │\n Event   Event   Event   Event   Event   Event\n```\n\n## Tips\n\n- Always call `describe_scene` after creating elements to verify layout\n- Use `batch_create_elements` for efficiency (multiple elements at once)\n- Group related elements before aligning for cleaner organization\n- Do NOT export or share links — the live embedded canvas auto-syncs for the user\n- Use `create_from_mermaid` for quick flowcharts from Mermaid syntax\n</instructions>\n</skill>\n","tool_call_id":"call_VfpRcJYgzNUK3Prw5TDkbMNj","metadata":null,"timestamp":"2026-02-16T01:16:54.629052Z","part_kind":"tool-return"}],"timestamp":"2026-02-16T01:16:54.631676Z","instructions":"You are a Deep Agent, an AI assistant that helps users accomplish tasks using tools. You respond with text and tool calls.\n\n## Core Behavior\n\n- Be concise and direct. Don't over-explain unless asked.\n- NEVER add unnecessary preamble (\"Sure!\", \"Great question!\", \"I'll now...\").\n- Don't say \"I'll now do X\" — just do it.\n- If the request is ambiguous, ask questions before acting.\n- Prioritize accuracy over validating the user's beliefs.\n\n## Workflow\n\nWhen the user asks you to do something:\n\n1. **Understand first** — read relevant files, check existing patterns. Gather enough context to start, then iterate.\n2. **Act** — implement the solution. Work quickly but accurately.\n3. **Verify** — check your work against what was asked. Your first attempt is rarely perfect — iterate.\n\nKeep working until the task is fully complete. Don't stop partway and explain what you would do — just do it. Only yield back to the user when the task is done or you're genuinely blocked.\n\n## Tool Usage\n\n- Use specialized tools over shell equivalents when available (e.g., `read_file` over `cat`, `edit_file` over `sed`, `glob` over `find`).\n- When performing multiple independent operations, make all tool calls in a single response — don't make sequential calls when parallel is possible.\n- Read files before editing them — understand existing content before making changes.\n- Mimic existing code style, naming conventions, and patterns.\n\n## File Reading\n\nWhen reading multiple files or exploring large files, use pagination:\n- Start with `read_file(path, limit=100)` to scan structure.\n- Read targeted sections with offset/limit.\n- Only read full files when necessary for editing.\n\n## Subagent Delegation\n\n- Delegate specialized or independent subtasks to subagents to work in parallel.\n- Be specific in task descriptions — subagents don't have your full context.\n- Synthesize subagent results before presenting to the user.\n\n## Error Handling\n\n- If something fails repeatedly, stop and analyze *why* — don't keep retrying the same approach.\n- If blocked, explain what's wrong and ask for guidance.\n- Consider alternative approaches before giving up.\n\n## Progress Updates\n\nFor longer tasks, provide brief progress updates — a concise sentence recapping what you've done and what's next.\n\n\nYou are DeepResearch, an autonomous research agent. Your mission is to produce\ncomprehensive, well-cited research reports on any topic.\n\n## When to Use the Planner\n\n**Use the planner subagent** (`task(description=\"...\", subagent_type=\"planner\")`) ONLY for:\n- Complex, multi-step research requiring investigation of multiple sub-topics\n- Ambiguous queries where you need to clarify scope, depth, or focus with the user\n- Comparative research across 3+ options (e.g., \"Compare React vs Vue vs Svelte\")\n- Literature reviews or deep-dive reports\n\n**Do NOT use the planner for:**\n- Simple factual questions (\"How does photosynthesis work?\")\n- Diagram/visualization requests (\"Draw me a flowchart of X\")\n- Single-topic explanations you already know well\n- Quick tasks where the answer is straightforward\n\nWhen in doubt: if you can answer confidently without web search, just answer directly.\nIf you need to search multiple sources and synthesize a report, use the planner.\n\n## Research Process (for complex research tasks)\n\n### 1. PLAN\n- Delegate to the planner: `task(description=\"<question>\", subagent_type=\"planner\")`\n- The planner will ask clarifying questions and produce a structured research plan\n- Follow the plan step by step\n\n### 2. SETUP (after receiving plan)\n- Create a TODO list based on the plan's sub-questions (use `write_todos`)\n- Load relevant skills: `load_skill(\"research-methodology\")`, `load_skill(\"report-writing\")`\n\n### 3. SEARCH (per sub-question from plan)\n- Search the web for recent information (use Tavily search tools)\n- For each promising result, read the full page content (use Jina reader tools)\n- Focus on authoritative sources: official docs, academic papers, reputable news\n\n### 4. COLLECT\n- Save key findings to `/workspace/notes/` as markdown files\n- One file per sub-question (e.g., `/workspace/notes/01-background.md`)\n- Include source URL and access date for every fact\n- Mark confidence: [HIGH], [MEDIUM], [LOW]\n- Note any contradictions between sources\n\n### 5. SYNTHESIZE\n- Read all collected notes from `/workspace/notes/`\n- Write a structured report to `/workspace/report.md`\n- Use inline citations [1], [2], [3] throughout\n- Include a complete References section at the end\n\n### 6. REVIEW\n- Re-read the report for completeness\n- Verify all claims have citations\n- Check for contradictions or gaps\n- Update TODOs as completed\n\n## Report Format\n\n```markdown\n# [Descriptive Title]\n\n## Executive Summary\n[2-3 paragraph overview of key findings]\n\n## 1. [Section Title]\n[Content with inline citations [1][2]]\n\n## 2. [Section Title]\n[Content with inline citations [3][4]]\n\n...\n\n## Conclusions\n[Key takeaways and implications]\n\n## References\n[1] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n[2] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n...\n```\n\n## Source Evaluation Guidelines\n\n- **Prefer primary sources** over secondary summaries\n- **Check publication date** — prefer recent for tech/science topics\n- **Cross-reference claims** across multiple sources\n- **Reliability hierarchy**: Academic papers > Official docs > Reputable news > Blog posts > Forums\n- **Always note** when sources disagree\n\n## Tool Usage Guidelines\n\n- Use **planner subagent** for complex multi-source research (not for simple questions)\n- Use **web search** to find relevant pages and get overviews\n- Use **URL reader** to get full content from promising search results\n- Use **write_file** to save notes and the final report\n- Use **read_file** to review your own notes during synthesis\n- Use **write_todos/read_todos** to track your research progress\n- Use **skills** (load_skill) for research methodology and report writing guides\n\n## Visualization with Excalidraw\n\nWhen a visual explanation would be helpful, use Excalidraw MCP tools to create diagrams.\nYou can create diagrams directly — no planner needed for visualization tasks.\nLoad the `diagram-design` skill for detailed guidelines.\n\n**When to create diagrams:**\n- Comparing 3+ options → comparison diagram\n- Process with 4+ steps → flowchart\n- System with multiple components → architecture diagram\n- Chronological events → timeline\n\n**Workflow:**\n1. Plan the diagram (type, elements, layout)\n2. Create elements with `create_element` or `batch_create_elements`\n3. Arrange with `align_elements` and `distribute_elements`\n4. Inspect with `describe_scene` — verify it looks right\n5. Adjust with `update_element` if needed\n\n**Quick alternative:** Use `create_from_mermaid` for simple flowcharts from Mermaid syntax.\n\n**CRITICAL — Canvas is live-embedded for the user:**\n- NEVER call `export_to_excalidraw_url` or `export_scene` or `export_to_image`\n- NEVER include excalidraw.com links or \"Open Diagram\" links in your response\n- NEVER say \"here is the diagram link\" or \"you can view it at...\"\n- The user already sees the diagram live in an embedded canvas — just describe what you drew\n\n## Parallel Research with Subagents\n\nFor complex research with **multiple independent sub-topics**, use async subagents to research them **in parallel** instead of sequentially:\n\n### Basic parallel workflow\n1. Create specialized agents if needed: `create_agent(name=\"topic-researcher\", description=\"Researches a specific topic\", instructions=\"You are a focused researcher. Search the web, read sources, and return a detailed summary with citations.\")`\n2. Dispatch async tasks for each sub-topic:\n   - `task(description=\"Research topic A in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic B in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic C in depth\", subagent_type=\"general-purpose\", mode=\"async\")`\n3. Monitor progress: `check_task(task_id)` or `list_active_tasks()`\n4. Collect all results, then synthesize into the final report yourself\n\n### Agent Teams (for large coordinated research)\nFor **3+ parallel workstreams** that need shared state and coordination:\n1. `spawn_team(team_name=\"research-team\", members=[...])` — define team members with roles\n2. `assign_task(member_name=\"...\", task_description=\"...\")` — assign work to each member\n3. `check_teammates()` — monitor progress across the team\n4. `dissolve_team()` — clean up when done\n\n### When to parallelize\n- **YES**: Comparative research (each option researched by a separate agent), multi-source investigation, large literature review (divide by sub-topic)\n- **NO**: Sequential tasks where B depends on A's results, simple single-topic research, when you need to synthesize before continuing\n\n## Important Rules\n\n1. **Use judgment on planning** — use planner for complex research, skip it for simple tasks\n2. **Always cite sources** — never make claims without a reference (in research reports)\n3. **Save notes incrementally** — don't keep everything in context\n4. **Write the report to a file** — the final deliverable is `/workspace/report.md`\n5. **Be thorough** — search multiple times with different queries if needed\n6. **Be honest about uncertainty** — note when evidence is limited or conflicting\n7. **Visualize when helpful** — create Excalidraw diagrams for complex comparisons, flows, or architectures\n\n\n## Application-Specific Capabilities\n\n1. **Web Search**: Search the web via MCP tools (Tavily, Brave Search, Jina URL reader, Firecrawl)\n1b. **Browser Automation**: For JS-heavy pages that don't render well with URL readers, use Playwright MCP tools (navigate, screenshot, click, fill) to interact with web pages directly.\n2. **File Operations**: Read, write, edit, and search files in the workspace\n3. **Code Execution**: Execute Python code in an isolated Docker sandbox (pre-installed: pandas, numpy, matplotlib, scikit-learn, seaborn, plotly)\n4. **Code Review**: Delegate to the 'code-reviewer' subagent for code quality review\n5. **Quick Reference**: Load the 'quick-reference' skill for command shortcuts\n6. **Dynamic Agents**: Create new specialized agents at runtime with `create_agent(name, description, instructions)`, then delegate tasks to them. Use `list_agents()` to see created agents, `remove_agent(name)` to delete them.\n7. **Plan Mode**: For **complex, multi-step research** (comparative studies, literature reviews, ambiguous queries needing clarification), delegate to the 'planner' subagent which will ask clarifying questions and create a structured research plan. **Do NOT use the planner** for simple questions, diagram requests, or topics you already know well — just answer directly or create the visualization.\n8. **Diagrams (Excalidraw)**: Create visual diagrams — comparisons, flowcharts, architecture diagrams, timelines — using Excalidraw MCP tools. Load the 'diagram-design' skill for best practices. Use `describe_scene` to inspect diagrams. NEVER call `export_to_excalidraw_url` or share diagram links — the user sees a live embedded canvas. Just describe what you drew in plain text.\n9. **Parallel Subagents**: For complex research with multiple independent sub-topics, dispatch async tasks with `task(description=\"...\", subagent_type=\"...\", mode=\"async\")`. Monitor with `check_task(task_id)` and `list_active_tasks()`. Create specialized agents dynamically for parallel work.\n10. **Agent Teams**: For large coordinated research (3+ parallel workstreams), use `spawn_team(team_name, members)` to create a team, `assign_task(member, desc)` to distribute work, `check_teammates()` to monitor, and `dissolve_team()` when done.\n\n## Shell Commands & Code Execution\n\nYou have an `execute` tool for running shell commands. **Always use it** when the user asks\nto run a command. The tool may require user approval (human-in-the-loop) — that's expected,\njust call it and wait for approval. Never refuse to run a command or say you can't — use `execute`.\n\n## Error Handling - BE AUTONOMOUS\n\n**CRITICAL**: When something fails, FIX IT YOURSELF. Don't ask for permission to fix obvious issues.\n\nExamples of things you should fix automatically WITHOUT asking:\n- Missing Python modules -> `pip install <module>` and retry\n- File not found -> check the path, create the file if needed\n- Syntax errors in code -> fix the code and retry\n- Permission errors -> try alternative approaches\n- Command not found -> install the tool or use alternatives\n\n**NEVER** say things like:\n- \"Would you like me to install...?\"\n- \"Should I fix this error?\"\n- \"Do you want me to retry?\"\n\n**ALWAYS** just fix the problem and continue. Only ask the user if:\n- You've tried multiple approaches and all failed\n- The error requires a decision about business logic or design\n- You need information only the user can provide\n\n## File Locations\n\n- Uploaded files are in: /uploads/\n- Your workspace is: /workspace/\n- Save generated files (charts, reports, notes) to /workspace/\n\n\n## Task Management\n\nYou have access to todo tools to track your tasks:\n- `read_todos` - View current tasks with their IDs and statuses\n- `write_todos` - Replace the entire todo list\n- `add_todo` - Add a single new task\n- `update_todo_status` - Change a task's status by ID\n- `remove_todo` - Delete a task by ID\n\nWhen working on tasks:\n1. Break down complex tasks into smaller steps\n2. Mark exactly one task as in_progress at a time\n3. Mark tasks as completed immediately after finishing\n\n\n\n## Console Tools\n\nYou have access to console tools for file operations and command execution:\n\n### File Operations\n- `ls`: List files in a directory\n- `read_file`: Read file content with line numbers\n- `write_file`: Create or overwrite a file\n- `edit_file`: Replace strings in a file\n- `glob`: Find files matching a pattern\n- `grep`: Search for patterns in files\n\n### Shell Execution\n- `execute`: Run shell commands (if enabled)\n\n### Best Practices\n- Always read a file before editing it\n- Use edit_file for small changes, write_file for complete rewrites\n- Use glob to find files before operating on them\n- Be careful with destructive shell commands\n\n\n## Available Subagents\n\nYou can delegate tasks to the following specialized subagents:\n\n### code-reviewer\nReviews Python code for quality, security, and best practices. Delegate code review tasks to this subagent.\n\n### planner\nPlans implementation of complex tasks. Analyzes code, asks clarifying questions, and creates detailed step-by-step implementation plans. Use for tasks that need architectural decisions, multi-file changes, or when the user says 'use plan mode'. Do NOT use for simple tasks.\n\n### general-purpose\nA general-purpose agent for a wide variety of tasks.\nUse this when no specialized subagent matches the task requirements.\nCapable of research, analysis, writing, and problem-solving.\n\n## Subagent Execution Modes\n\nYou can delegate tasks to subagents in two modes:\n\n### Sync Mode (Default)\n- Use for simple, quick tasks\n- Use when you need the result immediately\n- Use when the task requires back-and-forth communication\n- The task runs and you wait for the result\n\n### Async Mode (Background)\n- Use for complex, long-running tasks\n- Use when you can continue with other work while waiting\n- Use for tasks that can run independently\n- Returns a task handle immediately - check status later","kind":"request","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null},{"parts":[{"tool_name":"tavily_tavily_search","args":"{\"query\":\"photosynthesis process diagram explanation\",\"max_results\":5,\"include_images\":false,\"include_raw_content\":false}","tool_call_id":"call_ic1mRZCkFQFCl2X0YdhXvaxG","id":null,"provider_name":null,"provider_details":null,"part_kind":"tool-call"}],"usage":{"input_tokens":10251,"cache_write_tokens":0,"cache_read_tokens":9216,"output_tokens":39,"input_audio_tokens":0,"cache_audio_read_tokens":0,"output_audio_tokens":0,"details":{"accepted_prediction_tokens":0,"audio_tokens":0,"reasoning_tokens":0,"rejected_prediction_tokens":0}},"model_name":"gpt-4.1-2025-04-14","timestamp":"2026-02-16T01:16:56.656284Z","kind":"response","provider_name":"openai","provider_url":"https://api.openai.com/v1/","provider_details":{"timestamp":"2026-02-16T01:16:55Z","finish_reason":"tool_calls"},"provider_response_id":"chatcmpl-D9hWJfRrUTYV5PeO9mgaq5iLGgph2","finish_reason":"tool_call","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null},{"parts":[{"tool_name":"tavily_tavily_search","content":"Detailed Results:\n\nTitle: Photosynthesis Process: Steps, Equation & Diagram\nURL: https://microbenotes.com/photosynthesis/\nContent: **Photosynthesis is defined as the process, utilized by green plants and photosynthetic bacteria, where electromagnetic radiation is converted into chemical energy and uses light energy to convert carbon dioxide and water into carbohydrates and oxygen.**. * Photosynthesis is a light-driven oxidation-reduction reaction where the energy from the light is used to oxidize water, releasing oxygen gas and hydrogen ions, followed by the transfer of electrons to carbon dioxide, reducing it to organic molecules. * Photosynthetic pigments are the molecules involved in absorbing electromagnetic radiation, transferring the energy of the absorbed photons to the reaction center, resulting in photochemical reactions in the organisms capable of photosynthesis. * In the light-dependent reactions of photosynthesis, the chlorophyll absorbs high energy, short-wavelength light, which excites the electrons present inside the thylakoid membrane. Light independent reactions of photosynthesis are anabolic reactions that lead to the formation of a six-carbon compound, glucose in plants. | The reactants of photosynthesis are light energy, carbon dioxide, and water.\n\nTitle: Photosynthesis: AP® Biology Crash Course\nURL: https://www.albert.io/blog/photosynthesis-ap-biology-crash-course/\nContent: In Photo system II, light energy from photons splits water into its constituents:two H+ ions,two electrons, and a single oxygen atom in a process known as photolysis. At this stage, we introduce the electron transport chain, which is the mechanism by which electrons are transferred from the thylakoid membrane proteins to the NADP+ molecule – all of this occurs to produce ATP and water necessary for the plant’s growth. At this stage, the electrons are further excited by light energy absorbed by the Photo system I. This energy is used to further the proton gradient across the chloroplast membrane, and the electron reduces the NADP+ molecule to NADPH. In the diagram below, the transfer of an electron from excitation by a photon of light energy (far left) through Photo systems II and I, to the formation of ATP and NADPH is depicted.\n\nTitle: Photosynthetic Cells - Photosynthesis, Chloroplast\nURL: https://www.nature.com/scitable/topicpage/photosynthetic-cells-14025371/\nContent: Arrows are used to represent storage or flow of inorganic carbon and organic carbon, or to give directionality to photosynthesis or decomposition processes between land plants, soil, aquatic systems, and the Earth's atmosphere. Image 5: View Full-Size Image Photosynthesis in land plants fixes atmospheric CO2 (inorganic carbon) as organic carbon, which is either stored as plant biomass, stored in soil, or decomposed back to CO2 through plant and soil respiration. Land plants are represented in the diagram by trees growing on a river bank beside a mountain range; this element is labeled \\\\\"a.\\\\\" A green arrow directed towards the trees from atmospheric carbon dioxide (CO<sub>2</sub>) in the sky represents the process of photosynthesis. Figure 4:Diagram of a chloroplast inside a cell, showing thylakoid stacks. Image 10: An illustration shows the light and dark reactions for photosynthesis drawn on top of a simplified image of a chloroplast, represented as an oviform capsule.\n\nTitle: Photosynthesis | Definition, Formula, Process, Diagram ...\nURL: https://www.britannica.com/science/photosynthesis\nContent: * History of the study of photosynthesis. * photosynthesis - Student Encyclopedia (Ages 11 and up). # photosynthesis. Coauthor of *Photosynthesis of Carbon Compounds;...*. ### Why is photosynthesis important? Additionally, almost all the oxygen in the atmosphere is because of the process of photosynthesis. If photosynthesis ceased, there would soon be little food or other organic matter on Earth, most organisms would disappear, and Earth’s atmosphere would eventually become nearly devoid of gaseous oxygen. **photosynthesis**, the process by which green plants and certain other organisms transform light energy into chemical energy. During photosynthesis in green plants, light energy is captured and used to convert water, carbon dioxide, and minerals into oxygen and energy-rich organic compounds. ## Importance of photosynthesis. If photosynthesis ceased, there would soon be little food or other organic matter on Earth. Energy produced by photosynthesis carried out by plants millions of years ago is responsible for the fossil fuels (i.e., coal, oil, and natural gas) that power industrial society.\n\nTitle: Intro to photosynthesis (article)\nURL: https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/a/intro-to-photosynthesis\nContent: [Skip to main content](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/a/intro-to-photosynthesis#main-content). [Skip to lesson content](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/a/intro-to-photosynthesis#content-library-content-panel). ### [Course: AP®︎/College Biology](https://www.khanacademy.org/science/ap-biology)>[Unit 3](https://www.khanacademy.org/science/ap-biology/cellular-energetics). *   [Photosynthesis](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/v/photosynthesis). *   [Intro to photosynthesis](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/a/intro-to-photosynthesis). *   [Breaking down photosynthesis stages](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/v/breaking-down-photosynthesis-stages). *   [Conceptual overview of light dependent reactions](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/v/conceptual-overview-of-light-dependent-reactions). *   [The light-dependent reactions](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/a/light-dependent-reactions). *   [The Calvin cycle](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/a/calvin-cycle). *   [Photosynthesis evolution](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/v/photosynthesis-evolution). *   [Photosynthesis review](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/a/hs-photosynthesis-review). *   [Photosynthesis](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/e/photosynthesis-exercise). [AP®︎/College Biology](https://www.khanacademy.org/science/ap-biology)>. [Cellular energetics](https://www.khanacademy.org/science/ap-biology/cellular-energetics)>. [Photosynthesis](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis). [Terms of use](https://www.khanacademy.org/about/docs/khan-academy-terms-of-service)[Privacy Policy](https://www.khanacademy.org/about/privacy-policy)[Cookie Notice](https://www.khanacademy.org/about/cookie-policy)[Accessibility Statement](https://www.khanacademy.org/about/accessibility-statement). [![Image 3](blob:http://localhost/111ba13e9b731fc4a075bb16f6d95200) Microsoft Teams](https://teams.microsoft.com/share?href=https%3A%2F%2Fwww.khanacademy.org%2Fscience%2Fap-biology%2Fcellular-energetics%2Fphotosynthesis%2Fa%2Fintro-to-photosynthesis&referrer=www.khanacademy.org). *   **Energy.** The glucose molecules serve as fuel for cells: their chemical energy can be harvested through processes like [cellular respiration](https://www.khanacademy.org/science/biology/cellular-respiration-and-fermentation/overview-of-cellular-respiration-steps/v/overview-of-cellular-respiration) and [fermentation](https://www.khanacademy.org/science/biology/cellular-respiration-and-fermentation/variations-on-cellular-respiration/v/lactic-acid-fermentation), which generate adenosine triphosphate—ATP‍, a small, energy-carrying molecule—for the cell’s immediate energy needs. _Image credit: modified from \"[Overview of photosynthesis: Figure 6](http://cnx.org/contents/b3c1e1d2-839c-42b0-a314-e119a8aafbdd@8.56:23/Overview-of-Photosynthesis)\" by OpenStax College, Concepts of Biology, [CC BY 3.0](https://creativecommons.org/licenses/by/3.0/us/)_. Each mesophyll cell contains organelles called [chloroplasts](https://www.khanacademy.org/science/biology/structure-of-a-cell/tour-of-organelles/a/chloroplasts-and-mitochondria), which are specialized to carry out the reactions of photosynthesis. Photosynthesis in the leaves of plants involves many steps, but it can be divided into two stages: the [light-dependent reactions](https://www.khanacademy.org/science/biology/photosynthesis-in-plants/the-light-dependent-reactions-of-photosynthesis/a/light-dependent-reactions) and the [Calvin cycle](https://www.khanacademy.org/science/biology/photosynthesis-in-plants/the-calvin-cycle-reactions/a/calvin-cycle). [Up next: video](https://www.khanacademy.org/science/ap-biology/cellular-energetics/photosynthesis/v/breaking-down-photosynthesis-stages).","tool_call_id":"call_ic1mRZCkFQFCl2X0YdhXvaxG","metadata":null,"timestamp":"2026-02-16T01:16:58.519527Z","part_kind":"tool-return"}],"timestamp":"2026-02-16T01:16:58.525596Z","instructions":"You are a Deep Agent, an AI assistant that helps users accomplish tasks using tools. You respond with text and tool calls.\n\n## Core Behavior\n\n- Be concise and direct. Don't over-explain unless asked.\n- NEVER add unnecessary preamble (\"Sure!\", \"Great question!\", \"I'll now...\").\n- Don't say \"I'll now do X\" — just do it.\n- If the request is ambiguous, ask questions before acting.\n- Prioritize accuracy over validating the user's beliefs.\n\n## Workflow\n\nWhen the user asks you to do something:\n\n1. **Understand first** — read relevant files, check existing patterns. Gather enough context to start, then iterate.\n2. **Act** — implement the solution. Work quickly but accurately.\n3. **Verify** — check your work against what was asked. Your first attempt is rarely perfect — iterate.\n\nKeep working until the task is fully complete. Don't stop partway and explain what you would do — just do it. Only yield back to the user when the task is done or you're genuinely blocked.\n\n## Tool Usage\n\n- Use specialized tools over shell equivalents when available (e.g., `read_file` over `cat`, `edit_file` over `sed`, `glob` over `find`).\n- When performing multiple independent operations, make all tool calls in a single response — don't make sequential calls when parallel is possible.\n- Read files before editing them — understand existing content before making changes.\n- Mimic existing code style, naming conventions, and patterns.\n\n## File Reading\n\nWhen reading multiple files or exploring large files, use pagination:\n- Start with `read_file(path, limit=100)` to scan structure.\n- Read targeted sections with offset/limit.\n- Only read full files when necessary for editing.\n\n## Subagent Delegation\n\n- Delegate specialized or independent subtasks to subagents to work in parallel.\n- Be specific in task descriptions — subagents don't have your full context.\n- Synthesize subagent results before presenting to the user.\n\n## Error Handling\n\n- If something fails repeatedly, stop and analyze *why* — don't keep retrying the same approach.\n- If blocked, explain what's wrong and ask for guidance.\n- Consider alternative approaches before giving up.\n\n## Progress Updates\n\nFor longer tasks, provide brief progress updates — a concise sentence recapping what you've done and what's next.\n\n\nYou are DeepResearch, an autonomous research agent. Your mission is to produce\ncomprehensive, well-cited research reports on any topic.\n\n## When to Use the Planner\n\n**Use the planner subagent** (`task(description=\"...\", subagent_type=\"planner\")`) ONLY for:\n- Complex, multi-step research requiring investigation of multiple sub-topics\n- Ambiguous queries where you need to clarify scope, depth, or focus with the user\n- Comparative research across 3+ options (e.g., \"Compare React vs Vue vs Svelte\")\n- Literature reviews or deep-dive reports\n\n**Do NOT use the planner for:**\n- Simple factual questions (\"How does photosynthesis work?\")\n- Diagram/visualization requests (\"Draw me a flowchart of X\")\n- Single-topic explanations you already know well\n- Quick tasks where the answer is straightforward\n\nWhen in doubt: if you can answer confidently without web search, just answer directly.\nIf you need to search multiple sources and synthesize a report, use the planner.\n\n## Research Process (for complex research tasks)\n\n### 1. PLAN\n- Delegate to the planner: `task(description=\"<question>\", subagent_type=\"planner\")`\n- The planner will ask clarifying questions and produce a structured research plan\n- Follow the plan step by step\n\n### 2. SETUP (after receiving plan)\n- Create a TODO list based on the plan's sub-questions (use `write_todos`)\n- Load relevant skills: `load_skill(\"research-methodology\")`, `load_skill(\"report-writing\")`\n\n### 3. SEARCH (per sub-question from plan)\n- Search the web for recent information (use Tavily search tools)\n- For each promising result, read the full page content (use Jina reader tools)\n- Focus on authoritative sources: official docs, academic papers, reputable news\n\n### 4. COLLECT\n- Save key findings to `/workspace/notes/` as markdown files\n- One file per sub-question (e.g., `/workspace/notes/01-background.md`)\n- Include source URL and access date for every fact\n- Mark confidence: [HIGH], [MEDIUM], [LOW]\n- Note any contradictions between sources\n\n### 5. SYNTHESIZE\n- Read all collected notes from `/workspace/notes/`\n- Write a structured report to `/workspace/report.md`\n- Use inline citations [1], [2], [3] throughout\n- Include a complete References section at the end\n\n### 6. REVIEW\n- Re-read the report for completeness\n- Verify all claims have citations\n- Check for contradictions or gaps\n- Update TODOs as completed\n\n## Report Format\n\n```markdown\n# [Descriptive Title]\n\n## Executive Summary\n[2-3 paragraph overview of key findings]\n\n## 1. [Section Title]\n[Content with inline citations [1][2]]\n\n## 2. [Section Title]\n[Content with inline citations [3][4]]\n\n...\n\n## Conclusions\n[Key takeaways and implications]\n\n## References\n[1] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n[2] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n...\n```\n\n## Source Evaluation Guidelines\n\n- **Prefer primary sources** over secondary summaries\n- **Check publication date** — prefer recent for tech/science topics\n- **Cross-reference claims** across multiple sources\n- **Reliability hierarchy**: Academic papers > Official docs > Reputable news > Blog posts > Forums\n- **Always note** when sources disagree\n\n## Tool Usage Guidelines\n\n- Use **planner subagent** for complex multi-source research (not for simple questions)\n- Use **web search** to find relevant pages and get overviews\n- Use **URL reader** to get full content from promising search results\n- Use **write_file** to save notes and the final report\n- Use **read_file** to review your own notes during synthesis\n- Use **write_todos/read_todos** to track your research progress\n- Use **skills** (load_skill) for research methodology and report writing guides\n\n## Visualization with Excalidraw\n\nWhen a visual explanation would be helpful, use Excalidraw MCP tools to create diagrams.\nYou can create diagrams directly — no planner needed for visualization tasks.\nLoad the `diagram-design` skill for detailed guidelines.\n\n**When to create diagrams:**\n- Comparing 3+ options → comparison diagram\n- Process with 4+ steps → flowchart\n- System with multiple components → architecture diagram\n- Chronological events → timeline\n\n**Workflow:**\n1. Plan the diagram (type, elements, layout)\n2. Create elements with `create_element` or `batch_create_elements`\n3. Arrange with `align_elements` and `distribute_elements`\n4. Inspect with `describe_scene` — verify it looks right\n5. Adjust with `update_element` if needed\n\n**Quick alternative:** Use `create_from_mermaid` for simple flowcharts from Mermaid syntax.\n\n**CRITICAL — Canvas is live-embedded for the user:**\n- NEVER call `export_to_excalidraw_url` or `export_scene` or `export_to_image`\n- NEVER include excalidraw.com links or \"Open Diagram\" links in your response\n- NEVER say \"here is the diagram link\" or \"you can view it at...\"\n- The user already sees the diagram live in an embedded canvas — just describe what you drew\n\n## Parallel Research with Subagents\n\nFor complex research with **multiple independent sub-topics**, use async subagents to research them **in parallel** instead of sequentially:\n\n### Basic parallel workflow\n1. Create specialized agents if needed: `create_agent(name=\"topic-researcher\", description=\"Researches a specific topic\", instructions=\"You are a focused researcher. Search the web, read sources, and return a detailed summary with citations.\")`\n2. Dispatch async tasks for each sub-topic:\n   - `task(description=\"Research topic A in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic B in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic C in depth\", subagent_type=\"general-purpose\", mode=\"async\")`\n3. Monitor progress: `check_task(task_id)` or `list_active_tasks()`\n4. Collect all results, then synthesize into the final report yourself\n\n### Agent Teams (for large coordinated research)\nFor **3+ parallel workstreams** that need shared state and coordination:\n1. `spawn_team(team_name=\"research-team\", members=[...])` — define team members with roles\n2. `assign_task(member_name=\"...\", task_description=\"...\")` — assign work to each member\n3. `check_teammates()` — monitor progress across the team\n4. `dissolve_team()` — clean up when done\n\n### When to parallelize\n- **YES**: Comparative research (each option researched by a separate agent), multi-source investigation, large literature review (divide by sub-topic)\n- **NO**: Sequential tasks where B depends on A's results, simple single-topic research, when you need to synthesize before continuing\n\n## Important Rules\n\n1. **Use judgment on planning** — use planner for complex research, skip it for simple tasks\n2. **Always cite sources** — never make claims without a reference (in research reports)\n3. **Save notes incrementally** — don't keep everything in context\n4. **Write the report to a file** — the final deliverable is `/workspace/report.md`\n5. **Be thorough** — search multiple times with different queries if needed\n6. **Be honest about uncertainty** — note when evidence is limited or conflicting\n7. **Visualize when helpful** — create Excalidraw diagrams for complex comparisons, flows, or architectures\n\n\n## Application-Specific Capabilities\n\n1. **Web Search**: Search the web via MCP tools (Tavily, Brave Search, Jina URL reader, Firecrawl)\n1b. **Browser Automation**: For JS-heavy pages that don't render well with URL readers, use Playwright MCP tools (navigate, screenshot, click, fill) to interact with web pages directly.\n2. **File Operations**: Read, write, edit, and search files in the workspace\n3. **Code Execution**: Execute Python code in an isolated Docker sandbox (pre-installed: pandas, numpy, matplotlib, scikit-learn, seaborn, plotly)\n4. **Code Review**: Delegate to the 'code-reviewer' subagent for code quality review\n5. **Quick Reference**: Load the 'quick-reference' skill for command shortcuts\n6. **Dynamic Agents**: Create new specialized agents at runtime with `create_agent(name, description, instructions)`, then delegate tasks to them. Use `list_agents()` to see created agents, `remove_agent(name)` to delete them.\n7. **Plan Mode**: For **complex, multi-step research** (comparative studies, literature reviews, ambiguous queries needing clarification), delegate to the 'planner' subagent which will ask clarifying questions and create a structured research plan. **Do NOT use the planner** for simple questions, diagram requests, or topics you already know well — just answer directly or create the visualization.\n8. **Diagrams (Excalidraw)**: Create visual diagrams — comparisons, flowcharts, architecture diagrams, timelines — using Excalidraw MCP tools. Load the 'diagram-design' skill for best practices. Use `describe_scene` to inspect diagrams. NEVER call `export_to_excalidraw_url` or share diagram links — the user sees a live embedded canvas. Just describe what you drew in plain text.\n9. **Parallel Subagents**: For complex research with multiple independent sub-topics, dispatch async tasks with `task(description=\"...\", subagent_type=\"...\", mode=\"async\")`. Monitor with `check_task(task_id)` and `list_active_tasks()`. Create specialized agents dynamically for parallel work.\n10. **Agent Teams**: For large coordinated research (3+ parallel workstreams), use `spawn_team(team_name, members)` to create a team, `assign_task(member, desc)` to distribute work, `check_teammates()` to monitor, and `dissolve_team()` when done.\n\n## Shell Commands & Code Execution\n\nYou have an `execute` tool for running shell commands. **Always use it** when the user asks\nto run a command. The tool may require user approval (human-in-the-loop) — that's expected,\njust call it and wait for approval. Never refuse to run a command or say you can't — use `execute`.\n\n## Error Handling - BE AUTONOMOUS\n\n**CRITICAL**: When something fails, FIX IT YOURSELF. Don't ask for permission to fix obvious issues.\n\nExamples of things you should fix automatically WITHOUT asking:\n- Missing Python modules -> `pip install <module>` and retry\n- File not found -> check the path, create the file if needed\n- Syntax errors in code -> fix the code and retry\n- Permission errors -> try alternative approaches\n- Command not found -> install the tool or use alternatives\n\n**NEVER** say things like:\n- \"Would you like me to install...?\"\n- \"Should I fix this error?\"\n- \"Do you want me to retry?\"\n\n**ALWAYS** just fix the problem and continue. Only ask the user if:\n- You've tried multiple approaches and all failed\n- The error requires a decision about business logic or design\n- You need information only the user can provide\n\n## File Locations\n\n- Uploaded files are in: /uploads/\n- Your workspace is: /workspace/\n- Save generated files (charts, reports, notes) to /workspace/\n\n\n## Task Management\n\nYou have access to todo tools to track your tasks:\n- `read_todos` - View current tasks with their IDs and statuses\n- `write_todos` - Replace the entire todo list\n- `add_todo` - Add a single new task\n- `update_todo_status` - Change a task's status by ID\n- `remove_todo` - Delete a task by ID\n\nWhen working on tasks:\n1. Break down complex tasks into smaller steps\n2. Mark exactly one task as in_progress at a time\n3. Mark tasks as completed immediately after finishing\n\n\n\n## Console Tools\n\nYou have access to console tools for file operations and command execution:\n\n### File Operations\n- `ls`: List files in a directory\n- `read_file`: Read file content with line numbers\n- `write_file`: Create or overwrite a file\n- `edit_file`: Replace strings in a file\n- `glob`: Find files matching a pattern\n- `grep`: Search for patterns in files\n\n### Shell Execution\n- `execute`: Run shell commands (if enabled)\n\n### Best Practices\n- Always read a file before editing it\n- Use edit_file for small changes, write_file for complete rewrites\n- Use glob to find files before operating on them\n- Be careful with destructive shell commands\n\n\n## Available Subagents\n\nYou can delegate tasks to the following specialized subagents:\n\n### code-reviewer\nReviews Python code for quality, security, and best practices. Delegate code review tasks to this subagent.\n\n### planner\nPlans implementation of complex tasks. Analyzes code, asks clarifying questions, and creates detailed step-by-step implementation plans. Use for tasks that need architectural decisions, multi-file changes, or when the user says 'use plan mode'. Do NOT use for simple tasks.\n\n### general-purpose\nA general-purpose agent for a wide variety of tasks.\nUse this when no specialized subagent matches the task requirements.\nCapable of research, analysis, writing, and problem-solving.\n\n## Subagent Execution Modes\n\nYou can delegate tasks to subagents in two modes:\n\n### Sync Mode (Default)\n- Use for simple, quick tasks\n- Use when you need the result immediately\n- Use when the task requires back-and-forth communication\n- The task runs and you wait for the result\n\n### Async Mode (Background)\n- Use for complex, long-running tasks\n- Use when you can continue with other work while waiting\n- Use for tasks that can run independently\n- Returns a task handle immediately - check status later","kind":"request","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null},{"parts":[{"tool_name":"write_file","args":"{\"path\":\"/workspace/photosynteza_mermaid.txt\",\"content\":\"flowchart TD\\n    A([Energia świetlna (Słońce)])\\n    B([Dwutlenek węgla (CO2)])\\n    C([Woda (H2O)])\\n    D([Chloroplast w liściu])\\n    E([Reakcje świetlne w tylakoidach])\\n    F([Tlen (O2)])\\n    G([Etap ciemny / cykl Calvina])\\n    H([Wytworzenie glukozy (C6H12O6)])\\n\\n    A --> D\\n    B --> D\\n    C --> D\\n    D --> E\\n    E --> F\\n    E --> G\\n    G --> H\\n\\n    F ---|Produkowany gaz| E\\n    H ---|Produkt końcowy – energia| G\\n\\n    style A fill:#ffd700,color:#000\\n    style B fill:#c3fae8,color:#000\\n    style C fill:#c3fae8,color:#000\\n    style D fill:#74c0fc,color:#000\\n    style E fill:#a5d8ff,color:#000\\n    style G fill:#ffe066,color:#000\\n    style H fill:#fab005,color:#000\\n    style F fill:#b2f2bb,color:#000\"}","tool_call_id":"call_cJDQ1ZLSbH4JmeEAhuXzxrDG","id":null,"provider_name":null,"provider_details":null,"part_kind":"tool-call"}],"usage":{"input_tokens":12362,"cache_write_tokens":0,"cache_read_tokens":10240,"output_tokens":312,"input_audio_tokens":0,"cache_audio_read_tokens":0,"output_audio_tokens":0,"details":{"accepted_prediction_tokens":0,"audio_tokens":0,"reasoning_tokens":0,"rejected_prediction_tokens":0}},"model_name":"gpt-4.1-2025-04-14","timestamp":"2026-02-16T01:16:59.797172Z","kind":"response","provider_name":"openai","provider_url":"https://api.openai.com/v1/","provider_details":{"timestamp":"2026-02-16T01:16:59Z","finish_reason":"tool_calls"},"provider_response_id":"chatcmpl-D9hWNqA8uQsxX96y4SSonXoSNk2fM","finish_reason":"tool_call","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null},{"parts":[{"tool_name":"write_file","content":"Wrote 29 lines to /workspace/photosynteza_mermaid.txt","tool_call_id":"call_cJDQ1ZLSbH4JmeEAhuXzxrDG","metadata":null,"timestamp":"2026-02-16T01:17:03.964778Z","part_kind":"tool-return"}],"timestamp":"2026-02-16T01:17:03.968227Z","instructions":"You are a Deep Agent, an AI assistant that helps users accomplish tasks using tools. You respond with text and tool calls.\n\n## Core Behavior\n\n- Be concise and direct. Don't over-explain unless asked.\n- NEVER add unnecessary preamble (\"Sure!\", \"Great question!\", \"I'll now...\").\n- Don't say \"I'll now do X\" — just do it.\n- If the request is ambiguous, ask questions before acting.\n- Prioritize accuracy over validating the user's beliefs.\n\n## Workflow\n\nWhen the user asks you to do something:\n\n1. **Understand first** — read relevant files, check existing patterns. Gather enough context to start, then iterate.\n2. **Act** — implement the solution. Work quickly but accurately.\n3. **Verify** — check your work against what was asked. Your first attempt is rarely perfect — iterate.\n\nKeep working until the task is fully complete. Don't stop partway and explain what you would do — just do it. Only yield back to the user when the task is done or you're genuinely blocked.\n\n## Tool Usage\n\n- Use specialized tools over shell equivalents when available (e.g., `read_file` over `cat`, `edit_file` over `sed`, `glob` over `find`).\n- When performing multiple independent operations, make all tool calls in a single response — don't make sequential calls when parallel is possible.\n- Read files before editing them — understand existing content before making changes.\n- Mimic existing code style, naming conventions, and patterns.\n\n## File Reading\n\nWhen reading multiple files or exploring large files, use pagination:\n- Start with `read_file(path, limit=100)` to scan structure.\n- Read targeted sections with offset/limit.\n- Only read full files when necessary for editing.\n\n## Subagent Delegation\n\n- Delegate specialized or independent subtasks to subagents to work in parallel.\n- Be specific in task descriptions — subagents don't have your full context.\n- Synthesize subagent results before presenting to the user.\n\n## Error Handling\n\n- If something fails repeatedly, stop and analyze *why* — don't keep retrying the same approach.\n- If blocked, explain what's wrong and ask for guidance.\n- Consider alternative approaches before giving up.\n\n## Progress Updates\n\nFor longer tasks, provide brief progress updates — a concise sentence recapping what you've done and what's next.\n\n\nYou are DeepResearch, an autonomous research agent. Your mission is to produce\ncomprehensive, well-cited research reports on any topic.\n\n## When to Use the Planner\n\n**Use the planner subagent** (`task(description=\"...\", subagent_type=\"planner\")`) ONLY for:\n- Complex, multi-step research requiring investigation of multiple sub-topics\n- Ambiguous queries where you need to clarify scope, depth, or focus with the user\n- Comparative research across 3+ options (e.g., \"Compare React vs Vue vs Svelte\")\n- Literature reviews or deep-dive reports\n\n**Do NOT use the planner for:**\n- Simple factual questions (\"How does photosynthesis work?\")\n- Diagram/visualization requests (\"Draw me a flowchart of X\")\n- Single-topic explanations you already know well\n- Quick tasks where the answer is straightforward\n\nWhen in doubt: if you can answer confidently without web search, just answer directly.\nIf you need to search multiple sources and synthesize a report, use the planner.\n\n## Research Process (for complex research tasks)\n\n### 1. PLAN\n- Delegate to the planner: `task(description=\"<question>\", subagent_type=\"planner\")`\n- The planner will ask clarifying questions and produce a structured research plan\n- Follow the plan step by step\n\n### 2. SETUP (after receiving plan)\n- Create a TODO list based on the plan's sub-questions (use `write_todos`)\n- Load relevant skills: `load_skill(\"research-methodology\")`, `load_skill(\"report-writing\")`\n\n### 3. SEARCH (per sub-question from plan)\n- Search the web for recent information (use Tavily search tools)\n- For each promising result, read the full page content (use Jina reader tools)\n- Focus on authoritative sources: official docs, academic papers, reputable news\n\n### 4. COLLECT\n- Save key findings to `/workspace/notes/` as markdown files\n- One file per sub-question (e.g., `/workspace/notes/01-background.md`)\n- Include source URL and access date for every fact\n- Mark confidence: [HIGH], [MEDIUM], [LOW]\n- Note any contradictions between sources\n\n### 5. SYNTHESIZE\n- Read all collected notes from `/workspace/notes/`\n- Write a structured report to `/workspace/report.md`\n- Use inline citations [1], [2], [3] throughout\n- Include a complete References section at the end\n\n### 6. REVIEW\n- Re-read the report for completeness\n- Verify all claims have citations\n- Check for contradictions or gaps\n- Update TODOs as completed\n\n## Report Format\n\n```markdown\n# [Descriptive Title]\n\n## Executive Summary\n[2-3 paragraph overview of key findings]\n\n## 1. [Section Title]\n[Content with inline citations [1][2]]\n\n## 2. [Section Title]\n[Content with inline citations [3][4]]\n\n...\n\n## Conclusions\n[Key takeaways and implications]\n\n## References\n[1] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n[2] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n...\n```\n\n## Source Evaluation Guidelines\n\n- **Prefer primary sources** over secondary summaries\n- **Check publication date** — prefer recent for tech/science topics\n- **Cross-reference claims** across multiple sources\n- **Reliability hierarchy**: Academic papers > Official docs > Reputable news > Blog posts > Forums\n- **Always note** when sources disagree\n\n## Tool Usage Guidelines\n\n- Use **planner subagent** for complex multi-source research (not for simple questions)\n- Use **web search** to find relevant pages and get overviews\n- Use **URL reader** to get full content from promising search results\n- Use **write_file** to save notes and the final report\n- Use **read_file** to review your own notes during synthesis\n- Use **write_todos/read_todos** to track your research progress\n- Use **skills** (load_skill) for research methodology and report writing guides\n\n## Visualization with Excalidraw\n\nWhen a visual explanation would be helpful, use Excalidraw MCP tools to create diagrams.\nYou can create diagrams directly — no planner needed for visualization tasks.\nLoad the `diagram-design` skill for detailed guidelines.\n\n**When to create diagrams:**\n- Comparing 3+ options → comparison diagram\n- Process with 4+ steps → flowchart\n- System with multiple components → architecture diagram\n- Chronological events → timeline\n\n**Workflow:**\n1. Plan the diagram (type, elements, layout)\n2. Create elements with `create_element` or `batch_create_elements`\n3. Arrange with `align_elements` and `distribute_elements`\n4. Inspect with `describe_scene` — verify it looks right\n5. Adjust with `update_element` if needed\n\n**Quick alternative:** Use `create_from_mermaid` for simple flowcharts from Mermaid syntax.\n\n**CRITICAL — Canvas is live-embedded for the user:**\n- NEVER call `export_to_excalidraw_url` or `export_scene` or `export_to_image`\n- NEVER include excalidraw.com links or \"Open Diagram\" links in your response\n- NEVER say \"here is the diagram link\" or \"you can view it at...\"\n- The user already sees the diagram live in an embedded canvas — just describe what you drew\n\n## Parallel Research with Subagents\n\nFor complex research with **multiple independent sub-topics**, use async subagents to research them **in parallel** instead of sequentially:\n\n### Basic parallel workflow\n1. Create specialized agents if needed: `create_agent(name=\"topic-researcher\", description=\"Researches a specific topic\", instructions=\"You are a focused researcher. Search the web, read sources, and return a detailed summary with citations.\")`\n2. Dispatch async tasks for each sub-topic:\n   - `task(description=\"Research topic A in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic B in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic C in depth\", subagent_type=\"general-purpose\", mode=\"async\")`\n3. Monitor progress: `check_task(task_id)` or `list_active_tasks()`\n4. Collect all results, then synthesize into the final report yourself\n\n### Agent Teams (for large coordinated research)\nFor **3+ parallel workstreams** that need shared state and coordination:\n1. `spawn_team(team_name=\"research-team\", members=[...])` — define team members with roles\n2. `assign_task(member_name=\"...\", task_description=\"...\")` — assign work to each member\n3. `check_teammates()` — monitor progress across the team\n4. `dissolve_team()` — clean up when done\n\n### When to parallelize\n- **YES**: Comparative research (each option researched by a separate agent), multi-source investigation, large literature review (divide by sub-topic)\n- **NO**: Sequential tasks where B depends on A's results, simple single-topic research, when you need to synthesize before continuing\n\n## Important Rules\n\n1. **Use judgment on planning** — use planner for complex research, skip it for simple tasks\n2. **Always cite sources** — never make claims without a reference (in research reports)\n3. **Save notes incrementally** — don't keep everything in context\n4. **Write the report to a file** — the final deliverable is `/workspace/report.md`\n5. **Be thorough** — search multiple times with different queries if needed\n6. **Be honest about uncertainty** — note when evidence is limited or conflicting\n7. **Visualize when helpful** — create Excalidraw diagrams for complex comparisons, flows, or architectures\n\n\n## Application-Specific Capabilities\n\n1. **Web Search**: Search the web via MCP tools (Tavily, Brave Search, Jina URL reader, Firecrawl)\n1b. **Browser Automation**: For JS-heavy pages that don't render well with URL readers, use Playwright MCP tools (navigate, screenshot, click, fill) to interact with web pages directly.\n2. **File Operations**: Read, write, edit, and search files in the workspace\n3. **Code Execution**: Execute Python code in an isolated Docker sandbox (pre-installed: pandas, numpy, matplotlib, scikit-learn, seaborn, plotly)\n4. **Code Review**: Delegate to the 'code-reviewer' subagent for code quality review\n5. **Quick Reference**: Load the 'quick-reference' skill for command shortcuts\n6. **Dynamic Agents**: Create new specialized agents at runtime with `create_agent(name, description, instructions)`, then delegate tasks to them. Use `list_agents()` to see created agents, `remove_agent(name)` to delete them.\n7. **Plan Mode**: For **complex, multi-step research** (comparative studies, literature reviews, ambiguous queries needing clarification), delegate to the 'planner' subagent which will ask clarifying questions and create a structured research plan. **Do NOT use the planner** for simple questions, diagram requests, or topics you already know well — just answer directly or create the visualization.\n8. **Diagrams (Excalidraw)**: Create visual diagrams — comparisons, flowcharts, architecture diagrams, timelines — using Excalidraw MCP tools. Load the 'diagram-design' skill for best practices. Use `describe_scene` to inspect diagrams. NEVER call `export_to_excalidraw_url` or share diagram links — the user sees a live embedded canvas. Just describe what you drew in plain text.\n9. **Parallel Subagents**: For complex research with multiple independent sub-topics, dispatch async tasks with `task(description=\"...\", subagent_type=\"...\", mode=\"async\")`. Monitor with `check_task(task_id)` and `list_active_tasks()`. Create specialized agents dynamically for parallel work.\n10. **Agent Teams**: For large coordinated research (3+ parallel workstreams), use `spawn_team(team_name, members)` to create a team, `assign_task(member, desc)` to distribute work, `check_teammates()` to monitor, and `dissolve_team()` when done.\n\n## Shell Commands & Code Execution\n\nYou have an `execute` tool for running shell commands. **Always use it** when the user asks\nto run a command. The tool may require user approval (human-in-the-loop) — that's expected,\njust call it and wait for approval. Never refuse to run a command or say you can't — use `execute`.\n\n## Error Handling - BE AUTONOMOUS\n\n**CRITICAL**: When something fails, FIX IT YOURSELF. Don't ask for permission to fix obvious issues.\n\nExamples of things you should fix automatically WITHOUT asking:\n- Missing Python modules -> `pip install <module>` and retry\n- File not found -> check the path, create the file if needed\n- Syntax errors in code -> fix the code and retry\n- Permission errors -> try alternative approaches\n- Command not found -> install the tool or use alternatives\n\n**NEVER** say things like:\n- \"Would you like me to install...?\"\n- \"Should I fix this error?\"\n- \"Do you want me to retry?\"\n\n**ALWAYS** just fix the problem and continue. Only ask the user if:\n- You've tried multiple approaches and all failed\n- The error requires a decision about business logic or design\n- You need information only the user can provide\n\n## File Locations\n\n- Uploaded files are in: /uploads/\n- Your workspace is: /workspace/\n- Save generated files (charts, reports, notes) to /workspace/\n\n\n## Task Management\n\nYou have access to todo tools to track your tasks:\n- `read_todos` - View current tasks with their IDs and statuses\n- `write_todos` - Replace the entire todo list\n- `add_todo` - Add a single new task\n- `update_todo_status` - Change a task's status by ID\n- `remove_todo` - Delete a task by ID\n\nWhen working on tasks:\n1. Break down complex tasks into smaller steps\n2. Mark exactly one task as in_progress at a time\n3. Mark tasks as completed immediately after finishing\n\n\n\n## Console Tools\n\nYou have access to console tools for file operations and command execution:\n\n### File Operations\n- `ls`: List files in a directory\n- `read_file`: Read file content with line numbers\n- `write_file`: Create or overwrite a file\n- `edit_file`: Replace strings in a file\n- `glob`: Find files matching a pattern\n- `grep`: Search for patterns in files\n\n### Shell Execution\n- `execute`: Run shell commands (if enabled)\n\n### Best Practices\n- Always read a file before editing it\n- Use edit_file for small changes, write_file for complete rewrites\n- Use glob to find files before operating on them\n- Be careful with destructive shell commands\n\n\n## Available Subagents\n\nYou can delegate tasks to the following specialized subagents:\n\n### code-reviewer\nReviews Python code for quality, security, and best practices. Delegate code review tasks to this subagent.\n\n### planner\nPlans implementation of complex tasks. Analyzes code, asks clarifying questions, and creates detailed step-by-step implementation plans. Use for tasks that need architectural decisions, multi-file changes, or when the user says 'use plan mode'. Do NOT use for simple tasks.\n\n### general-purpose\nA general-purpose agent for a wide variety of tasks.\nUse this when no specialized subagent matches the task requirements.\nCapable of research, analysis, writing, and problem-solving.\n\n## Subagent Execution Modes\n\nYou can delegate tasks to subagents in two modes:\n\n### Sync Mode (Default)\n- Use for simple, quick tasks\n- Use when you need the result immediately\n- Use when the task requires back-and-forth communication\n- The task runs and you wait for the result\n\n### Async Mode (Background)\n- Use for complex, long-running tasks\n- Use when you can continue with other work while waiting\n- Use for tasks that can run independently\n- Returns a task handle immediately - check status later","kind":"request","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null},{"parts":[{"tool_name":"create_agent","args":"{\"name\":\"mermaid-diagram-renderer\",\"description\":\"Renders flowcharts from Mermaid syntax into Excalidraw diagrams for biological processes.\",\"instructions\":\"Given a file with a valid Mermaid flowchart describing a biological process, use create_from_mermaid to render the diagram as an Excalidraw scene in the user's workspace. Layout and label clearly, use visual grouping and color if relevant. After creation, use describe_scene to verify the structure and main labels.\"}","tool_call_id":"call_tMWl6PQQpDBBQBHaajuQgWHZ","id":null,"provider_name":null,"provider_details":null,"part_kind":"tool-call"}],"usage":{"input_tokens":12697,"cache_write_tokens":0,"cache_read_tokens":9088,"output_tokens":103,"input_audio_tokens":0,"cache_audio_read_tokens":0,"output_audio_tokens":0,"details":{"accepted_prediction_tokens":0,"audio_tokens":0,"reasoning_tokens":0,"rejected_prediction_tokens":0}},"model_name":"gpt-4.1-2025-04-14","timestamp":"2026-02-16T01:17:05.113101Z","kind":"response","provider_name":"openai","provider_url":"https://api.openai.com/v1/","provider_details":{"timestamp":"2026-02-16T01:17:04Z","finish_reason":"tool_calls"},"provider_response_id":"chatcmpl-D9hWSy9er7KBRdmSH7ktVej4cna06","finish_reason":"tool_call","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null},{"parts":[{"tool_name":"create_agent","content":"Agent 'mermaid-diagram-renderer' created successfully.\nModel: openai:gpt-4.1-mini\nDescription: Renders flowcharts from Mermaid syntax into Excalidraw diagrams for biological processes.\nUse task(description, 'mermaid-diagram-renderer') to delegate tasks.","tool_call_id":"call_tMWl6PQQpDBBQBHaajuQgWHZ","metadata":null,"timestamp":"2026-02-16T01:17:06.721817Z","part_kind":"tool-return"}],"timestamp":"2026-02-16T01:17:06.722667Z","instructions":"You are a Deep Agent, an AI assistant that helps users accomplish tasks using tools. You respond with text and tool calls.\n\n## Core Behavior\n\n- Be concise and direct. Don't over-explain unless asked.\n- NEVER add unnecessary preamble (\"Sure!\", \"Great question!\", \"I'll now...\").\n- Don't say \"I'll now do X\" — just do it.\n- If the request is ambiguous, ask questions before acting.\n- Prioritize accuracy over validating the user's beliefs.\n\n## Workflow\n\nWhen the user asks you to do something:\n\n1. **Understand first** — read relevant files, check existing patterns. Gather enough context to start, then iterate.\n2. **Act** — implement the solution. Work quickly but accurately.\n3. **Verify** — check your work against what was asked. Your first attempt is rarely perfect — iterate.\n\nKeep working until the task is fully complete. Don't stop partway and explain what you would do — just do it. Only yield back to the user when the task is done or you're genuinely blocked.\n\n## Tool Usage\n\n- Use specialized tools over shell equivalents when available (e.g., `read_file` over `cat`, `edit_file` over `sed`, `glob` over `find`).\n- When performing multiple independent operations, make all tool calls in a single response — don't make sequential calls when parallel is possible.\n- Read files before editing them — understand existing content before making changes.\n- Mimic existing code style, naming conventions, and patterns.\n\n## File Reading\n\nWhen reading multiple files or exploring large files, use pagination:\n- Start with `read_file(path, limit=100)` to scan structure.\n- Read targeted sections with offset/limit.\n- Only read full files when necessary for editing.\n\n## Subagent Delegation\n\n- Delegate specialized or independent subtasks to subagents to work in parallel.\n- Be specific in task descriptions — subagents don't have your full context.\n- Synthesize subagent results before presenting to the user.\n\n## Error Handling\n\n- If something fails repeatedly, stop and analyze *why* — don't keep retrying the same approach.\n- If blocked, explain what's wrong and ask for guidance.\n- Consider alternative approaches before giving up.\n\n## Progress Updates\n\nFor longer tasks, provide brief progress updates — a concise sentence recapping what you've done and what's next.\n\n\nYou are DeepResearch, an autonomous research agent. Your mission is to produce\ncomprehensive, well-cited research reports on any topic.\n\n## When to Use the Planner\n\n**Use the planner subagent** (`task(description=\"...\", subagent_type=\"planner\")`) ONLY for:\n- Complex, multi-step research requiring investigation of multiple sub-topics\n- Ambiguous queries where you need to clarify scope, depth, or focus with the user\n- Comparative research across 3+ options (e.g., \"Compare React vs Vue vs Svelte\")\n- Literature reviews or deep-dive reports\n\n**Do NOT use the planner for:**\n- Simple factual questions (\"How does photosynthesis work?\")\n- Diagram/visualization requests (\"Draw me a flowchart of X\")\n- Single-topic explanations you already know well\n- Quick tasks where the answer is straightforward\n\nWhen in doubt: if you can answer confidently without web search, just answer directly.\nIf you need to search multiple sources and synthesize a report, use the planner.\n\n## Research Process (for complex research tasks)\n\n### 1. PLAN\n- Delegate to the planner: `task(description=\"<question>\", subagent_type=\"planner\")`\n- The planner will ask clarifying questions and produce a structured research plan\n- Follow the plan step by step\n\n### 2. SETUP (after receiving plan)\n- Create a TODO list based on the plan's sub-questions (use `write_todos`)\n- Load relevant skills: `load_skill(\"research-methodology\")`, `load_skill(\"report-writing\")`\n\n### 3. SEARCH (per sub-question from plan)\n- Search the web for recent information (use Tavily search tools)\n- For each promising result, read the full page content (use Jina reader tools)\n- Focus on authoritative sources: official docs, academic papers, reputable news\n\n### 4. COLLECT\n- Save key findings to `/workspace/notes/` as markdown files\n- One file per sub-question (e.g., `/workspace/notes/01-background.md`)\n- Include source URL and access date for every fact\n- Mark confidence: [HIGH], [MEDIUM], [LOW]\n- Note any contradictions between sources\n\n### 5. SYNTHESIZE\n- Read all collected notes from `/workspace/notes/`\n- Write a structured report to `/workspace/report.md`\n- Use inline citations [1], [2], [3] throughout\n- Include a complete References section at the end\n\n### 6. REVIEW\n- Re-read the report for completeness\n- Verify all claims have citations\n- Check for contradictions or gaps\n- Update TODOs as completed\n\n## Report Format\n\n```markdown\n# [Descriptive Title]\n\n## Executive Summary\n[2-3 paragraph overview of key findings]\n\n## 1. [Section Title]\n[Content with inline citations [1][2]]\n\n## 2. [Section Title]\n[Content with inline citations [3][4]]\n\n...\n\n## Conclusions\n[Key takeaways and implications]\n\n## References\n[1] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n[2] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n...\n```\n\n## Source Evaluation Guidelines\n\n- **Prefer primary sources** over secondary summaries\n- **Check publication date** — prefer recent for tech/science topics\n- **Cross-reference claims** across multiple sources\n- **Reliability hierarchy**: Academic papers > Official docs > Reputable news > Blog posts > Forums\n- **Always note** when sources disagree\n\n## Tool Usage Guidelines\n\n- Use **planner subagent** for complex multi-source research (not for simple questions)\n- Use **web search** to find relevant pages and get overviews\n- Use **URL reader** to get full content from promising search results\n- Use **write_file** to save notes and the final report\n- Use **read_file** to review your own notes during synthesis\n- Use **write_todos/read_todos** to track your research progress\n- Use **skills** (load_skill) for research methodology and report writing guides\n\n## Visualization with Excalidraw\n\nWhen a visual explanation would be helpful, use Excalidraw MCP tools to create diagrams.\nYou can create diagrams directly — no planner needed for visualization tasks.\nLoad the `diagram-design` skill for detailed guidelines.\n\n**When to create diagrams:**\n- Comparing 3+ options → comparison diagram\n- Process with 4+ steps → flowchart\n- System with multiple components → architecture diagram\n- Chronological events → timeline\n\n**Workflow:**\n1. Plan the diagram (type, elements, layout)\n2. Create elements with `create_element` or `batch_create_elements`\n3. Arrange with `align_elements` and `distribute_elements`\n4. Inspect with `describe_scene` — verify it looks right\n5. Adjust with `update_element` if needed\n\n**Quick alternative:** Use `create_from_mermaid` for simple flowcharts from Mermaid syntax.\n\n**CRITICAL — Canvas is live-embedded for the user:**\n- NEVER call `export_to_excalidraw_url` or `export_scene` or `export_to_image`\n- NEVER include excalidraw.com links or \"Open Diagram\" links in your response\n- NEVER say \"here is the diagram link\" or \"you can view it at...\"\n- The user already sees the diagram live in an embedded canvas — just describe what you drew\n\n## Parallel Research with Subagents\n\nFor complex research with **multiple independent sub-topics**, use async subagents to research them **in parallel** instead of sequentially:\n\n### Basic parallel workflow\n1. Create specialized agents if needed: `create_agent(name=\"topic-researcher\", description=\"Researches a specific topic\", instructions=\"You are a focused researcher. Search the web, read sources, and return a detailed summary with citations.\")`\n2. Dispatch async tasks for each sub-topic:\n   - `task(description=\"Research topic A in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic B in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic C in depth\", subagent_type=\"general-purpose\", mode=\"async\")`\n3. Monitor progress: `check_task(task_id)` or `list_active_tasks()`\n4. Collect all results, then synthesize into the final report yourself\n\n### Agent Teams (for large coordinated research)\nFor **3+ parallel workstreams** that need shared state and coordination:\n1. `spawn_team(team_name=\"research-team\", members=[...])` — define team members with roles\n2. `assign_task(member_name=\"...\", task_description=\"...\")` — assign work to each member\n3. `check_teammates()` — monitor progress across the team\n4. `dissolve_team()` — clean up when done\n\n### When to parallelize\n- **YES**: Comparative research (each option researched by a separate agent), multi-source investigation, large literature review (divide by sub-topic)\n- **NO**: Sequential tasks where B depends on A's results, simple single-topic research, when you need to synthesize before continuing\n\n## Important Rules\n\n1. **Use judgment on planning** — use planner for complex research, skip it for simple tasks\n2. **Always cite sources** — never make claims without a reference (in research reports)\n3. **Save notes incrementally** — don't keep everything in context\n4. **Write the report to a file** — the final deliverable is `/workspace/report.md`\n5. **Be thorough** — search multiple times with different queries if needed\n6. **Be honest about uncertainty** — note when evidence is limited or conflicting\n7. **Visualize when helpful** — create Excalidraw diagrams for complex comparisons, flows, or architectures\n\n\n## Application-Specific Capabilities\n\n1. **Web Search**: Search the web via MCP tools (Tavily, Brave Search, Jina URL reader, Firecrawl)\n1b. **Browser Automation**: For JS-heavy pages that don't render well with URL readers, use Playwright MCP tools (navigate, screenshot, click, fill) to interact with web pages directly.\n2. **File Operations**: Read, write, edit, and search files in the workspace\n3. **Code Execution**: Execute Python code in an isolated Docker sandbox (pre-installed: pandas, numpy, matplotlib, scikit-learn, seaborn, plotly)\n4. **Code Review**: Delegate to the 'code-reviewer' subagent for code quality review\n5. **Quick Reference**: Load the 'quick-reference' skill for command shortcuts\n6. **Dynamic Agents**: Create new specialized agents at runtime with `create_agent(name, description, instructions)`, then delegate tasks to them. Use `list_agents()` to see created agents, `remove_agent(name)` to delete them.\n7. **Plan Mode**: For **complex, multi-step research** (comparative studies, literature reviews, ambiguous queries needing clarification), delegate to the 'planner' subagent which will ask clarifying questions and create a structured research plan. **Do NOT use the planner** for simple questions, diagram requests, or topics you already know well — just answer directly or create the visualization.\n8. **Diagrams (Excalidraw)**: Create visual diagrams — comparisons, flowcharts, architecture diagrams, timelines — using Excalidraw MCP tools. Load the 'diagram-design' skill for best practices. Use `describe_scene` to inspect diagrams. NEVER call `export_to_excalidraw_url` or share diagram links — the user sees a live embedded canvas. Just describe what you drew in plain text.\n9. **Parallel Subagents**: For complex research with multiple independent sub-topics, dispatch async tasks with `task(description=\"...\", subagent_type=\"...\", mode=\"async\")`. Monitor with `check_task(task_id)` and `list_active_tasks()`. Create specialized agents dynamically for parallel work.\n10. **Agent Teams**: For large coordinated research (3+ parallel workstreams), use `spawn_team(team_name, members)` to create a team, `assign_task(member, desc)` to distribute work, `check_teammates()` to monitor, and `dissolve_team()` when done.\n\n## Shell Commands & Code Execution\n\nYou have an `execute` tool for running shell commands. **Always use it** when the user asks\nto run a command. The tool may require user approval (human-in-the-loop) — that's expected,\njust call it and wait for approval. Never refuse to run a command or say you can't — use `execute`.\n\n## Error Handling - BE AUTONOMOUS\n\n**CRITICAL**: When something fails, FIX IT YOURSELF. Don't ask for permission to fix obvious issues.\n\nExamples of things you should fix automatically WITHOUT asking:\n- Missing Python modules -> `pip install <module>` and retry\n- File not found -> check the path, create the file if needed\n- Syntax errors in code -> fix the code and retry\n- Permission errors -> try alternative approaches\n- Command not found -> install the tool or use alternatives\n\n**NEVER** say things like:\n- \"Would you like me to install...?\"\n- \"Should I fix this error?\"\n- \"Do you want me to retry?\"\n\n**ALWAYS** just fix the problem and continue. Only ask the user if:\n- You've tried multiple approaches and all failed\n- The error requires a decision about business logic or design\n- You need information only the user can provide\n\n## File Locations\n\n- Uploaded files are in: /uploads/\n- Your workspace is: /workspace/\n- Save generated files (charts, reports, notes) to /workspace/\n\n\n## Task Management\n\nYou have access to todo tools to track your tasks:\n- `read_todos` - View current tasks with their IDs and statuses\n- `write_todos` - Replace the entire todo list\n- `add_todo` - Add a single new task\n- `update_todo_status` - Change a task's status by ID\n- `remove_todo` - Delete a task by ID\n\nWhen working on tasks:\n1. Break down complex tasks into smaller steps\n2. Mark exactly one task as in_progress at a time\n3. Mark tasks as completed immediately after finishing\n\n\n\n## Console Tools\n\nYou have access to console tools for file operations and command execution:\n\n### File Operations\n- `ls`: List files in a directory\n- `read_file`: Read file content with line numbers\n- `write_file`: Create or overwrite a file\n- `edit_file`: Replace strings in a file\n- `glob`: Find files matching a pattern\n- `grep`: Search for patterns in files\n\n### Shell Execution\n- `execute`: Run shell commands (if enabled)\n\n### Best Practices\n- Always read a file before editing it\n- Use edit_file for small changes, write_file for complete rewrites\n- Use glob to find files before operating on them\n- Be careful with destructive shell commands\n\n\n## Available Subagents\n\nYou can delegate tasks to the following specialized subagents:\n\n### code-reviewer\nReviews Python code for quality, security, and best practices. Delegate code review tasks to this subagent.\n\n### planner\nPlans implementation of complex tasks. Analyzes code, asks clarifying questions, and creates detailed step-by-step implementation plans. Use for tasks that need architectural decisions, multi-file changes, or when the user says 'use plan mode'. Do NOT use for simple tasks.\n\n### general-purpose\nA general-purpose agent for a wide variety of tasks.\nUse this when no specialized subagent matches the task requirements.\nCapable of research, analysis, writing, and problem-solving.\n\n## Subagent Execution Modes\n\nYou can delegate tasks to subagents in two modes:\n\n### Sync Mode (Default)\n- Use for simple, quick tasks\n- Use when you need the result immediately\n- Use when the task requires back-and-forth communication\n- The task runs and you wait for the result\n\n### Async Mode (Background)\n- Use for complex, long-running tasks\n- Use when you can continue with other work while waiting\n- Use for tasks that can run independently\n- Returns a task handle immediately - check status later","kind":"request","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null},{"parts":[{"tool_name":"task","args":"{\"description\":\"Render the diagram for photosynthesis from the Mermaid flowchart in /workspace/photosynteza_mermaid.txt as an Excalidraw scene. Make sure all main entities (słońce/światło, CO2, H2O, chloroplast, reakcje świetlne, tlen, cykl Calvina, glukoza) are visible and labeled. After generation, use describe_scene to check main elements and relationships.\",\"subagent_type\":\"mermaid-diagram-renderer\"}","tool_call_id":"call_yTfmpUrHuT1hASAWWHbJZ3MI","id":null,"provider_name":null,"provider_details":null,"part_kind":"tool-call"}],"usage":{"input_tokens":12867,"cache_write_tokens":0,"cache_read_tokens":12544,"output_tokens":112,"input_audio_tokens":0,"cache_audio_read_tokens":0,"output_audio_tokens":0,"details":{"accepted_prediction_tokens":0,"audio_tokens":0,"reasoning_tokens":0,"rejected_prediction_tokens":0}},"model_name":"gpt-4.1-2025-04-14","timestamp":"2026-02-16T01:17:09.266255Z","kind":"response","provider_name":"openai","provider_url":"https://api.openai.com/v1/","provider_details":{"timestamp":"2026-02-16T01:17:07Z","finish_reason":"tool_calls"},"provider_response_id":"chatcmpl-D9hWViPDQ7UWGjENgGKwLzce9nBWc","finish_reason":"tool_call","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null},{"parts":[{"tool_name":"task","content":"The Excalidraw scene for photosynthesis contains the following main rectangular labeled elements:\n- Energia świetlna (Słońce) (yellow gold)\n- Dwutlenek węgla (CO2) (light cyan)\n- Woda (H2O) (light cyan)\n- Chloroplast w liściu (blue)\n- Reakcje świetlne w tylakoidach (light blue)\n- Tlen (O2) (light green)\n- Etap ciemny / cykl Calvina (yellow)\n- Wytworzenie glukozy (C6H12O6) (orange)\n\nArrows show the flow of energy and substances:\n- From Słońce, CO2, H2O to Chloroplast\n- From Chloroplast to Reakcje świetlne\n- From Reakcje świetlne to Tlen and Cykl Calvina\n- From Cykl Calvina to Glukoza\n\nThere are dotted arrows indicating feedback:\n- Produced gaz (Tlen) back to Reakcje świetlne\n- Product końcowy (Glukoza) back to Cykl Calvina as energy source\n\nAll main entities and connections from the Mermaid diagram are visible and clearly labeled in color-coded boxes with arrows. The layout is arranged roughly left-to-right and top-to-bottom for clarity and logical flow.\n\nThis completes the rendering and verification of the photosynthesis biological process diagram. Let me know if you need it shared or any further adjustments.","tool_call_id":"call_yTfmpUrHuT1hASAWWHbJZ3MI","metadata":null,"timestamp":"2026-02-16T01:18:04.272377Z","part_kind":"tool-return"}],"timestamp":"2026-02-16T01:18:04.274726Z","instructions":"You are a Deep Agent, an AI assistant that helps users accomplish tasks using tools. You respond with text and tool calls.\n\n## Core Behavior\n\n- Be concise and direct. Don't over-explain unless asked.\n- NEVER add unnecessary preamble (\"Sure!\", \"Great question!\", \"I'll now...\").\n- Don't say \"I'll now do X\" — just do it.\n- If the request is ambiguous, ask questions before acting.\n- Prioritize accuracy over validating the user's beliefs.\n\n## Workflow\n\nWhen the user asks you to do something:\n\n1. **Understand first** — read relevant files, check existing patterns. Gather enough context to start, then iterate.\n2. **Act** — implement the solution. Work quickly but accurately.\n3. **Verify** — check your work against what was asked. Your first attempt is rarely perfect — iterate.\n\nKeep working until the task is fully complete. Don't stop partway and explain what you would do — just do it. Only yield back to the user when the task is done or you're genuinely blocked.\n\n## Tool Usage\n\n- Use specialized tools over shell equivalents when available (e.g., `read_file` over `cat`, `edit_file` over `sed`, `glob` over `find`).\n- When performing multiple independent operations, make all tool calls in a single response — don't make sequential calls when parallel is possible.\n- Read files before editing them — understand existing content before making changes.\n- Mimic existing code style, naming conventions, and patterns.\n\n## File Reading\n\nWhen reading multiple files or exploring large files, use pagination:\n- Start with `read_file(path, limit=100)` to scan structure.\n- Read targeted sections with offset/limit.\n- Only read full files when necessary for editing.\n\n## Subagent Delegation\n\n- Delegate specialized or independent subtasks to subagents to work in parallel.\n- Be specific in task descriptions — subagents don't have your full context.\n- Synthesize subagent results before presenting to the user.\n\n## Error Handling\n\n- If something fails repeatedly, stop and analyze *why* — don't keep retrying the same approach.\n- If blocked, explain what's wrong and ask for guidance.\n- Consider alternative approaches before giving up.\n\n## Progress Updates\n\nFor longer tasks, provide brief progress updates — a concise sentence recapping what you've done and what's next.\n\n\nYou are DeepResearch, an autonomous research agent. Your mission is to produce\ncomprehensive, well-cited research reports on any topic.\n\n## When to Use the Planner\n\n**Use the planner subagent** (`task(description=\"...\", subagent_type=\"planner\")`) ONLY for:\n- Complex, multi-step research requiring investigation of multiple sub-topics\n- Ambiguous queries where you need to clarify scope, depth, or focus with the user\n- Comparative research across 3+ options (e.g., \"Compare React vs Vue vs Svelte\")\n- Literature reviews or deep-dive reports\n\n**Do NOT use the planner for:**\n- Simple factual questions (\"How does photosynthesis work?\")\n- Diagram/visualization requests (\"Draw me a flowchart of X\")\n- Single-topic explanations you already know well\n- Quick tasks where the answer is straightforward\n\nWhen in doubt: if you can answer confidently without web search, just answer directly.\nIf you need to search multiple sources and synthesize a report, use the planner.\n\n## Research Process (for complex research tasks)\n\n### 1. PLAN\n- Delegate to the planner: `task(description=\"<question>\", subagent_type=\"planner\")`\n- The planner will ask clarifying questions and produce a structured research plan\n- Follow the plan step by step\n\n### 2. SETUP (after receiving plan)\n- Create a TODO list based on the plan's sub-questions (use `write_todos`)\n- Load relevant skills: `load_skill(\"research-methodology\")`, `load_skill(\"report-writing\")`\n\n### 3. SEARCH (per sub-question from plan)\n- Search the web for recent information (use Tavily search tools)\n- For each promising result, read the full page content (use Jina reader tools)\n- Focus on authoritative sources: official docs, academic papers, reputable news\n\n### 4. COLLECT\n- Save key findings to `/workspace/notes/` as markdown files\n- One file per sub-question (e.g., `/workspace/notes/01-background.md`)\n- Include source URL and access date for every fact\n- Mark confidence: [HIGH], [MEDIUM], [LOW]\n- Note any contradictions between sources\n\n### 5. SYNTHESIZE\n- Read all collected notes from `/workspace/notes/`\n- Write a structured report to `/workspace/report.md`\n- Use inline citations [1], [2], [3] throughout\n- Include a complete References section at the end\n\n### 6. REVIEW\n- Re-read the report for completeness\n- Verify all claims have citations\n- Check for contradictions or gaps\n- Update TODOs as completed\n\n## Report Format\n\n```markdown\n# [Descriptive Title]\n\n## Executive Summary\n[2-3 paragraph overview of key findings]\n\n## 1. [Section Title]\n[Content with inline citations [1][2]]\n\n## 2. [Section Title]\n[Content with inline citations [3][4]]\n\n...\n\n## Conclusions\n[Key takeaways and implications]\n\n## References\n[1] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n[2] Author/Site, \"Title\", URL, Accessed: YYYY-MM-DD\n...\n```\n\n## Source Evaluation Guidelines\n\n- **Prefer primary sources** over secondary summaries\n- **Check publication date** — prefer recent for tech/science topics\n- **Cross-reference claims** across multiple sources\n- **Reliability hierarchy**: Academic papers > Official docs > Reputable news > Blog posts > Forums\n- **Always note** when sources disagree\n\n## Tool Usage Guidelines\n\n- Use **planner subagent** for complex multi-source research (not for simple questions)\n- Use **web search** to find relevant pages and get overviews\n- Use **URL reader** to get full content from promising search results\n- Use **write_file** to save notes and the final report\n- Use **read_file** to review your own notes during synthesis\n- Use **write_todos/read_todos** to track your research progress\n- Use **skills** (load_skill) for research methodology and report writing guides\n\n## Visualization with Excalidraw\n\nWhen a visual explanation would be helpful, use Excalidraw MCP tools to create diagrams.\nYou can create diagrams directly — no planner needed for visualization tasks.\nLoad the `diagram-design` skill for detailed guidelines.\n\n**When to create diagrams:**\n- Comparing 3+ options → comparison diagram\n- Process with 4+ steps → flowchart\n- System with multiple components → architecture diagram\n- Chronological events → timeline\n\n**Workflow:**\n1. Plan the diagram (type, elements, layout)\n2. Create elements with `create_element` or `batch_create_elements`\n3. Arrange with `align_elements` and `distribute_elements`\n4. Inspect with `describe_scene` — verify it looks right\n5. Adjust with `update_element` if needed\n\n**Quick alternative:** Use `create_from_mermaid` for simple flowcharts from Mermaid syntax.\n\n**CRITICAL — Canvas is live-embedded for the user:**\n- NEVER call `export_to_excalidraw_url` or `export_scene` or `export_to_image`\n- NEVER include excalidraw.com links or \"Open Diagram\" links in your response\n- NEVER say \"here is the diagram link\" or \"you can view it at...\"\n- The user already sees the diagram live in an embedded canvas — just describe what you drew\n\n## Parallel Research with Subagents\n\nFor complex research with **multiple independent sub-topics**, use async subagents to research them **in parallel** instead of sequentially:\n\n### Basic parallel workflow\n1. Create specialized agents if needed: `create_agent(name=\"topic-researcher\", description=\"Researches a specific topic\", instructions=\"You are a focused researcher. Search the web, read sources, and return a detailed summary with citations.\")`\n2. Dispatch async tasks for each sub-topic:\n   - `task(description=\"Research topic A in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic B in depth\", subagent_type=\"topic-researcher\", mode=\"async\")`\n   - `task(description=\"Research topic C in depth\", subagent_type=\"general-purpose\", mode=\"async\")`\n3. Monitor progress: `check_task(task_id)` or `list_active_tasks()`\n4. Collect all results, then synthesize into the final report yourself\n\n### Agent Teams (for large coordinated research)\nFor **3+ parallel workstreams** that need shared state and coordination:\n1. `spawn_team(team_name=\"research-team\", members=[...])` — define team members with roles\n2. `assign_task(member_name=\"...\", task_description=\"...\")` — assign work to each member\n3. `check_teammates()` — monitor progress across the team\n4. `dissolve_team()` — clean up when done\n\n### When to parallelize\n- **YES**: Comparative research (each option researched by a separate agent), multi-source investigation, large literature review (divide by sub-topic)\n- **NO**: Sequential tasks where B depends on A's results, simple single-topic research, when you need to synthesize before continuing\n\n## Important Rules\n\n1. **Use judgment on planning** — use planner for complex research, skip it for simple tasks\n2. **Always cite sources** — never make claims without a reference (in research reports)\n3. **Save notes incrementally** — don't keep everything in context\n4. **Write the report to a file** — the final deliverable is `/workspace/report.md`\n5. **Be thorough** — search multiple times with different queries if needed\n6. **Be honest about uncertainty** — note when evidence is limited or conflicting\n7. **Visualize when helpful** — create Excalidraw diagrams for complex comparisons, flows, or architectures\n\n\n## Application-Specific Capabilities\n\n1. **Web Search**: Search the web via MCP tools (Tavily, Brave Search, Jina URL reader, Firecrawl)\n1b. **Browser Automation**: For JS-heavy pages that don't render well with URL readers, use Playwright MCP tools (navigate, screenshot, click, fill) to interact with web pages directly.\n2. **File Operations**: Read, write, edit, and search files in the workspace\n3. **Code Execution**: Execute Python code in an isolated Docker sandbox (pre-installed: pandas, numpy, matplotlib, scikit-learn, seaborn, plotly)\n4. **Code Review**: Delegate to the 'code-reviewer' subagent for code quality review\n5. **Quick Reference**: Load the 'quick-reference' skill for command shortcuts\n6. **Dynamic Agents**: Create new specialized agents at runtime with `create_agent(name, description, instructions)`, then delegate tasks to them. Use `list_agents()` to see created agents, `remove_agent(name)` to delete them.\n7. **Plan Mode**: For **complex, multi-step research** (comparative studies, literature reviews, ambiguous queries needing clarification), delegate to the 'planner' subagent which will ask clarifying questions and create a structured research plan. **Do NOT use the planner** for simple questions, diagram requests, or topics you already know well — just answer directly or create the visualization.\n8. **Diagrams (Excalidraw)**: Create visual diagrams — comparisons, flowcharts, architecture diagrams, timelines — using Excalidraw MCP tools. Load the 'diagram-design' skill for best practices. Use `describe_scene` to inspect diagrams. NEVER call `export_to_excalidraw_url` or share diagram links — the user sees a live embedded canvas. Just describe what you drew in plain text.\n9. **Parallel Subagents**: For complex research with multiple independent sub-topics, dispatch async tasks with `task(description=\"...\", subagent_type=\"...\", mode=\"async\")`. Monitor with `check_task(task_id)` and `list_active_tasks()`. Create specialized agents dynamically for parallel work.\n10. **Agent Teams**: For large coordinated research (3+ parallel workstreams), use `spawn_team(team_name, members)` to create a team, `assign_task(member, desc)` to distribute work, `check_teammates()` to monitor, and `dissolve_team()` when done.\n\n## Shell Commands & Code Execution\n\nYou have an `execute` tool for running shell commands. **Always use it** when the user asks\nto run a command. The tool may require user approval (human-in-the-loop) — that's expected,\njust call it and wait for approval. Never refuse to run a command or say you can't — use `execute`.\n\n## Error Handling - BE AUTONOMOUS\n\n**CRITICAL**: When something fails, FIX IT YOURSELF. Don't ask for permission to fix obvious issues.\n\nExamples of things you should fix automatically WITHOUT asking:\n- Missing Python modules -> `pip install <module>` and retry\n- File not found -> check the path, create the file if needed\n- Syntax errors in code -> fix the code and retry\n- Permission errors -> try alternative approaches\n- Command not found -> install the tool or use alternatives\n\n**NEVER** say things like:\n- \"Would you like me to install...?\"\n- \"Should I fix this error?\"\n- \"Do you want me to retry?\"\n\n**ALWAYS** just fix the problem and continue. Only ask the user if:\n- You've tried multiple approaches and all failed\n- The error requires a decision about business logic or design\n- You need information only the user can provide\n\n## File Locations\n\n- Uploaded files are in: /uploads/\n- Your workspace is: /workspace/\n- Save generated files (charts, reports, notes) to /workspace/\n\n\n## Task Management\n\nYou have access to todo tools to track your tasks:\n- `read_todos` - View current tasks with their IDs and statuses\n- `write_todos` - Replace the entire todo list\n- `add_todo` - Add a single new task\n- `update_todo_status` - Change a task's status by ID\n- `remove_todo` - Delete a task by ID\n\nWhen working on tasks:\n1. Break down complex tasks into smaller steps\n2. Mark exactly one task as in_progress at a time\n3. Mark tasks as completed immediately after finishing\n\n\n\n## Console Tools\n\nYou have access to console tools for file operations and command execution:\n\n### File Operations\n- `ls`: List files in a directory\n- `read_file`: Read file content with line numbers\n- `write_file`: Create or overwrite a file\n- `edit_file`: Replace strings in a file\n- `glob`: Find files matching a pattern\n- `grep`: Search for patterns in files\n\n### Shell Execution\n- `execute`: Run shell commands (if enabled)\n\n### Best Practices\n- Always read a file before editing it\n- Use edit_file for small changes, write_file for complete rewrites\n- Use glob to find files before operating on them\n- Be careful with destructive shell commands\n\n\n## Available Subagents\n\nYou can delegate tasks to the following specialized subagents:\n\n### code-reviewer\nReviews Python code for quality, security, and best practices. Delegate code review tasks to this subagent.\n\n### planner\nPlans implementation of complex tasks. Analyzes code, asks clarifying questions, and creates detailed step-by-step implementation plans. Use for tasks that need architectural decisions, multi-file changes, or when the user says 'use plan mode'. Do NOT use for simple tasks.\n\n### general-purpose\nA general-purpose agent for a wide variety of tasks.\nUse this when no specialized subagent matches the task requirements.\nCapable of research, analysis, writing, and problem-solving.\n\n## Subagent Execution Modes\n\nYou can delegate tasks to subagents in two modes:\n\n### Sync Mode (Default)\n- Use for simple, quick tasks\n- Use when you need the result immediately\n- Use when the task requires back-and-forth communication\n- The task runs and you wait for the result\n\n### Async Mode (Background)\n- Use for complex, long-running tasks\n- Use when you can continue with other work while waiting\n- Use for tasks that can run independently\n- Returns a task handle immediately - check status later","kind":"request","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null},{"parts":[{"content":"Diagram procesu fotosyntezy został utworzony na kanwie. Zobaczysz na nim:\n\n- Energia świetlna (Słońce), Dwutlenek węgla (CO2) i Woda (H2O) trafiają do chloroplastu w liściu.\n- W chloroplaście zachodzą reakcje świetlne (w tylakoidach), podczas których powstaje tlen (O2).\n- Następnie produkty reakcji świetlnej trafiają do cyklu Calvina (etapu ciemnego), gdzie powstaje glukoza (C6H12O6).\n- Relacje i przepływ substancji oraz energii zilustrowane są kolorowymi strzałkami i boksami.\n\nDiagram logicznie pokazuje najważniejsze etapy i produkty fotosyntezy. Jeśli chcesz coś zmienić lub dodać, daj znać!","id":null,"provider_name":null,"provider_details":null,"part_kind":"text"}],"usage":{"input_tokens":13292,"cache_write_tokens":0,"cache_read_tokens":12672,"output_tokens":200,"input_audio_tokens":0,"cache_audio_read_tokens":0,"output_audio_tokens":0,"details":{"accepted_prediction_tokens":0,"audio_tokens":0,"reasoning_tokens":0,"rejected_prediction_tokens":0}},"model_name":"gpt-4.1-2025-04-14","timestamp":"2026-02-16T01:18:05.070111Z","kind":"response","provider_name":"openai","provider_url":"https://api.openai.com/v1/","provider_details":{"timestamp":"2026-02-16T01:18:04Z","finish_reason":"stop"},"provider_response_id":"chatcmpl-D9hXQWtBxtFlYoxRB4mC3Glmt9tLU","finish_reason":"stop","run_id":"d3d44b1f-c7bf-4bc0-997d-fc7e45e1f560","metadata":null}]